### 绘制梯形图的基本原则

1. 梯形图按**从上到下**，**从左到右**的顺序绘制；
2. 每个继电器为一个逻辑行，即一层阶梯。**每个逻辑行起于左母线**，终于右母线；
3. 继电器线圈与右母线直接连接，**不能在继电器线圈与右母线之间接其它元件**；
4. 在梯形图中，同一继电器的常开、常闭**触点可以多次被使用**，不受限制。但同一个继电器线圈，在程序运行中只能用（出现）一次。

# §4-1 FX系列PLC的基本逻辑指令（27条）

## 一、LD、LDI、OUT指令

* LD（Load）：常开触点与母线连接指令；
* LDI（Load Inverse）：常闭触点与母线连接指令；
* OUT（Out）：驱动线圈的输出指令。

![image-20230928162150280](4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20230928162150280.png)

![image-20230928162313438](4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20230928162313438.png)

1. 在用指令来表示梯形图时，其**程序步是不需要**输入的；
2. 一般情况下，**LD**（LDI）和**OUT**是**成对出现**的。如果不成对出现，则有特殊情况出现。

## 二、AND、ANI指令

* AND（And）：与指令，常开触点串联连接指令；
* ANI（And Inverse）：与非指令，常闭触点串联连接指令。

![image-20230928162503331](4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20230928162503331.png)
$$
\boxed{\begin{align}
&\rm LD&&\rm X0\\
&\rm AND&&\rm M101\\
&\rm OUT&&\rm Y3\\
&\rm LD&&\rm Y3\\
&\rm ANI&&\rm X3\\
&\rm OUT&&\rm M101\\
&\rm AND&&\rm T1\\
&\rm OUT&&\rm Y5
\end{align}}
$$
在OUT指令后面，通过触点可将数据输出至其它线圈，即通过触点去驱动其它线圈，称为：**连续输出**。

![image-20230928163528815](4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20230928163528815.png)

必须用多重输出MPS、MRD、MPP指令。

## 三、OR、ORI指令

* OR（OR）：常闭触点的并联连接指令
* ORI（OR Inverse）：常闭触点的并联连接指令。

![image-20230928163855735](4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20230928163855735.png)

OR、ORI指令可以多次并联连接。在下面的这个梯形图中，也存在所谓的“**逻辑块**”问题。

![image-20230928164254673](4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20230928164254673.png)

前面的例子是要进行逻辑“**块或**”操作，而这里将需要进行逻辑“**块与**”操作。

### 上节课重点

1. 三菱FX系列PLC的**输入**继电器和**输出继电器的编号**（也称为：地址）是怎样分配的？（八进制的）
2. 在梯形图中，有输入继电器（线圈）吗？（没有）
3. 梯形图中的触点通、断，分别对应寄存器（存储器中存储位）的什么状态？（0断开，1接通）
4. PLC中的<u>辅助继电器（M）能直接对外输出信号去驱动负载吗</u>？（不可以，只能作为中介和桥梁去驱动）
5. 断电保持辅助继电器有什么作用？（何时会用到它？）（瞬间掉电时。保证二次来电时仍有输出）
6. 定时器（T）（亦称：计时器）所定时间是怎样给出的？（使用K值赋）
7. 什么叫**通电延时**和**断电延时**？（通电延时：通电信号来的时候，延时一段时间才开始输出；断电延时：按停止的时候，输入不是马上断，过一段时间再断）如何利用定时器来实现通电延时、断电延时？
8. 使用**积分定时器**（断电保持时间继电器）时，应该注意什么？（或者说：为什么要有RST语句（命令）？）（如果没有RST语句会出现积分定时器定的时间到了之后一直有输出的情况，无法停止，除非掉电，必须用reset复位）
9. 使用**计数器**时，为什么也要有一条对应的RST语句？（和上题相同）
10. 程序跳转和子程序调用有什么区别？（或说：什么时候采用程序跳转？什么时候用子程序调用？）（程序跳转：只有两个分支，看条件成立与否走哪条分支；子程序调用：子程序可能会在运行中被多次调用，在原来的程序基础上多出一段，也就是子程序）
11. **怎样看主程序和子程序的分界**？（FEND。FEND和END之间就是子程序，FEND后面的程序就是子程序）
12. 通用数据寄存器和停电保持数据寄存器的区别是什么？（通用数据寄存器如果不存数值进去的话数据就一直保存下来，但断电就没了，停电保持数据寄存器就算断电也保存数据。HR0～HR199）
13. 梯形图绘制基本原则和**常用基本语句的使用**；（从上到下，从左到右。每个输出是一个阶梯，从左母线到右母线）
14. 什么是**连续输出**？（在OUT语句后面通过其他点的串联用于驱动其他输出）

【注意】后续课程将涉及编程，幻灯授课较快，希望大家在晚自习时，抽空能把书上相关的内容，再仔细地看看！！

## 四、ORB指令

* **ORB**（OR Block）：电路块（**逻辑块**）并联连接指令。
* **串联电路块**：两个以上的触点串联连接而成的电路。有时也称为：**触点组**

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007143310441.png" alt="image-20231007143310441" style="zoom:50%;" />

#### “块或”的编程方法

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007143432634.png" alt="image-20231007143432634" style="zoom:50%;" />

## 五、ANB指令

* **ANB**（And Block）：逻辑块串联连接指令

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007143609888.png" alt="image-20231007143609888" style="zoom:50%;" />

### “块与”的编程方法

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007143753321.png" alt="image-20231007143753321" style="zoom:50%;" />

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007144422931.png" alt="image-20231007144422931" style="zoom:50%;" />

### 编程技巧

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007144634322.png" alt="image-20231007144634322" style="zoom:50%;" />

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007145319353.png" alt="image-20231007145319353" style="zoom:50%;" />

## 六、边沿检测触发指令

* LDP/LDF、ANDP/ANDF、ORP/ORF 指令都是触点指令，这些指令的用法和LD、AND、OR相同，只是所表达的触点的功能有所不同。

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007145523409.png" alt="image-20231007145523409" style="zoom:50%;" />

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007145737869.png" alt="image-20231007145737869" style="zoom:50%;" />

## 七、栈存储器和多重输出指令

* **MPS**（Push）：**进栈**指令；
* **MRD**（Read）：**读栈**指令；
* **MPP**（Pop）：**出栈**指令。

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007150020714.png" alt="image-20231007150020714" style="zoom:50%;" />

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007150534169.png" alt="image-20231007150534169" style="zoom:50%;" />

### 注意

1. MPS、MRD、MPP这组指令的功能是将**连接点的结果存储起来**，以方便连接点后面电路的编程；
2. PLC中有11个存储运算中间结果的存储器，它们被称为：**栈存储器**。
3. 使用一次MPS命令，该时刻的运算结果就推入**栈的第一段**。当再次使用MPS时，当时的运算结果将推入栈的第一段，先推入的数据依次向栈的下一段推移。
4. **MRD**是最上段所存的最新数据的**读出**专用指令。**栈内的数据不发生下压或上移**。
5. 使用MPP指令，各数据依次向上段推移（称为：**弹出**或**出栈**）。最上段数据在读出后就从栈内消失。
6. 多重输出指令都是没有操作元件号的指令。
7. MPS与MPP必须**成对使用**。
8. 由于栈存储器仅有11个，所以MPS与MPP连续使用**次数必须少于11次**。（若多于11次，怎么办？）

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007150854478.png" alt="image-20231007150854478" style="zoom:50%;" />

### 举例

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007151133959.png" alt="image-20231007151133959" style="zoom:50%;" />

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007151508429.png" alt="image-20231007151508429" style="zoom:50%;" />

#### 一层栈电路（教材P46）

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007151716148.png" alt="image-20231007151716148" style="zoom:50%;" />

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007152130249.png" alt="image-20231007152130249" style="zoom:50%;" />

#### 二层栈电路

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007152331571.png" alt="image-20231007152331571" style="zoom:50%;" />

#### 四层栈电路

教材P47：相当于MPS和MPP嵌套。最多11层。其也可以用“连续输出”来编程。

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007152528101.png" alt="image-20231007152528101" style="zoom:50%;" />

## 八、主控与主控复位指令

* **MC**（Master Control）：主控指令或公共触点串联连接指令；
* **MCR**（Master Control Reset）：主控复位指令

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007152849676.png" alt="image-20231007152849676" style="zoom:50%;" />

### 注意

* 使用主控指令的触点称为**主控触点**，在梯形图中与一般触点相垂直。
* 在使用主控触点后，相当于母线移到主控触点的后面。
* 如果 MC 指令的输入触点断开时，**积算定时器计数器**用复位/置位指令驱动的软元件，**保持其当时的状态**；**非积算定时器**和用**OUT**驱动的元件变为**OFF**。
* **无嵌套**时，用**N0编程**；有嵌套时，N的编号次序增大。

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007153350115.png" alt="image-20231007153350115" style="zoom:50%;" />

#### 主控、主控复位指令的嵌套

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007153707909.png" alt="image-20231007153707909" style="zoom:50%;" />

## 九、置位和复位指令

* **RST**（Reset）：复位指令，使操作保持复位的指令。
* **SET**（Set）：置位指令，使操作保持的指令。

#### 说明：

1. 在任何情况下，**RST指令都优先执行**。
2. 计数器和移位寄存器处于复位状态下，不接收输入的数据。

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007155756854.png" alt="image-20231007155756854" style="zoom:50%;" />

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007160429355.png" alt="image-20231007160429355" style="zoom:50%;" />

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007160805332.png" alt="image-20231007160805332" style="zoom:50%;" />

![image-20231007162018202](4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007162018202.png)

## 十、脉冲输出指令

* **PLS**：**上升沿微分输出指令**。用于将指定信号的上升沿进行微分，并将微分结果送给PLS指令后面所指的目标软元件。
* **PLF**：下降沿微分输出指令。

#### 注意

* 使用**PLS**指令，元件Y、M仅在驱动输入**接通**（上升沿触发）后的一个扫描周期内动作（置1）。
* 使用**PLF**指令，元件Y、M仅在驱动输入**断开**（下降沿触发）后的一个扫描周期内动作（置1）。
* 特殊继电器不能使用PLS或PLF的操作元件。
* 在驱动输入接通时，PLC由运行→停机→运行，此时PLS M0动作，但**PLS M600（断电后由电池后备的辅助继电器）不动作**。这是因为M600是保持继电器，即使在断电停机时，其动作也能保持。

## 十一、空操作指令与结束指令

* **NOP**（Non Processing）：空操作指令。
  1. 用户存储器清零后，用户存贮器内容全部变为NOP（零）；
  2. 主要用于短路电路、改变电路功能及调试程序时用；
  3. 程序如果加入NOP，改动或追加程序时，可以减少序号的改动。另外，**用NOP指令替换已写入的指令，也可改变电路**；
* **END**（End）：结束指令，表示程序结束。
  1. 若在程序最后写入END，则END以后的程序将不再执行。
  2. **按段插入END**，可以**顺序扩大对各程序段的检查**，方便调试程序。

#### 注意：P54

在一个比较大的程序里，如果想删除掉某一语句，又怕以后可能还要改回来，就可以**将要删除的语句用NOP来替换**。否则，一旦删除后，可能就不容易找到在什么位置删除了语句。

<img src="4.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231007163639618.png" alt="image-20231007163639618" style="zoom:50%;" />