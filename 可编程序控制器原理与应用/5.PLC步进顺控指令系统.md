# §5-1 梯形图的顺序控制设计法

## 一、用经验设计法设计梯形图存在的问题

### 经验设计法

![image-20231019151607153](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019151607153.png)

1. 设计方法很难掌握，设计周期长；
2. 装置交付使用后维修困难。（相对而言，要看编程者熟练程度）

### 另类法

![image-20231019151655818](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019151655818.png)

### 第三种方法

就是本章要介绍的：**顺序控制**设计方法！

## 二、顺序控制设计法的基本思想

#### 步（状态）STEP

将系统的一个工作周期或一个控制过程划分成若于个顺序相连的阶段，这些阶段称为：**步（状态）**

#### 转换

1. 状态与状态之间由**转换分隔**；
2. 相邻的状态具有不同的动作。

#### 转换条件

1. 使系统由前级步进入下一步的信号称为：**转换条件**。
2. 当相邻两状态之间的转换条件满足时，就实现转换。

#### 有向线段

#### 动作或命令

每一步所完成的工作

# §5-2 顺序控制设计中的功能表图

## 一、概述

**功能表图**（Function Chart），也称为：**状态转移图**或**顺序功能图**，它是描述控制系统的控制过程、功能和特性的一种图形。

状态转移图具有直观、简单的特点，是设计PLC顺序控制程序的一种工具。

![image-20231019152111754](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019152111754.png)
$$
内部状态继电器
$$

## 二、状态转移图的绘制

1. **状态器用框图表示**，框内是状态器元件号；
2. 状态器之间用**有向线段**连接；
3. 其中从上到下、从左到右**箭头可以省去不画**；
4. 有向线段上的垂直短线和它旁边标注的文字符号或逻辑表达式表示**状态转移条件**，旁边的线圈等是**输出信号**。

Y1和Y2输出的不同：（1）Y1是用OUT指令驱动；（2）Y2是用SET指令置位，未复位前Y2一直保持接通。

1. 状态器**S20有效时**，输出Y1、Y2接通；
2. 程序等待转换条件X1动作；
3. 当X1一接通，状态就由S20转到S21，这时Y1断开，Y3接通，**Y2仍保持接通**。

### 举例

![image-20231019152600754](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019152600754.png)

1. 机械手将工件从A点向B点移送；（教材P64）。
2. 机械手的上升、下降与左移、右移都是由**双线圈两位电磁阀驱动气缸**来实现的。抓手对物件的松开、夹紧是由二个**单线圈**两位电磁阀驱动气缸完成，只有在电磁阀通电时抓手才能夹紧；
3. 该**机械手工作原点在左上方**，按下降、夹紧、上升、右移、下降、松开、上升、左移的顺序依次运行。

S2为**初始**状态，用**双线框**表示。当辅助继电器M8041、M8044接通时,状态从S2向S20转移，下降输出Y0动作。

![image-20231019153258980](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019153258980.png)

### 举例

![image-20231019161247152](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019161247152.png)

M8002在PLC刚启动时导通一个扫描周期

## 三、状态转移图的基本结构

![image-20231019162023202](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019162023202.png)

![image-20231019162214059](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019162214059.png)

![image-20231019162415287](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019162415287.png)

### 举例

![image-20231019162804079](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019162804079.png)

这是一个**三工位**钻床的工作台的俯视图

三个工位分别完成：

1. 送料（装工件）；
2. 钻孔；
3. 合格品检测，卸工件。

![image-20231019162615762](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019162615762.png)

## 四、状态转移图中转换实现的基本原则

功能表图中表示**活动状态的进展是由转换实现来完成的**。

### 1、转换实现的条件

1. 该转换的前级步是**活动步**；
2. 相应的转换条件得到满足。

### 2、转换实现应完成的操作

1. 将有向线段与相应转换符号相连的**后续步都变成活动步**；
2. 将有向线段与相应转换符号相连的**前级步都变成不活动步**。

## 五、状态转移图的特点

1. **两个步**绝对不能直接相连，必须用一个**转换**将它们**隔开**；
2. **两个转换**也不能直接相连，必须用一个**步**将它们**隔开**；
3. 功能表中的**初始步**一般对应于系统等待**启动的初始状态**，它是必不可少的；
4. 自控系统应能**多次重复执行**同一工艺过程，因此功能表图中应该是一个由有向线段组成的**闭环**；
5. 如果用**没有断电保持**功能的编程元件代表各步，PLC在开始进入RUN工作方式时，它们均处于断开状态，所以**必须用M8002**（特殊辅助继电器（初始脉冲））**的常开触点作为转换条件**，将初始步预置为活动步。

# §5-3 顺序控制梯形图的编程方式

## 一、使用启保停电路的编程方式

### 编程模型

![image-20231019163637363](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019163637363.png)

![image-20231019163755329](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019163755329.png)

## 二、以转换为中心的编程方式

### 编程模型

![image-20231019164045824](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231019164045824.png)

### 上节课重点

1. **状态转移图**（也称：顺序功能图）**的构成和执行过程**；
2. 状态转移图的基本结构有哪几种形式？（单序列，选择性分支与汇合，并行性分支与汇合）
3. 其它机型PLC模仿状态转移图的几个实现方法。（启停；以状态转移改变的）

**一定要**学会和掌握在启停控制的基础上，如何扩展到其它控制程序编写的方法！

### 路旁手控信号灯控制系统举例

![image-20231026143839114](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026143839114.png)

# §5-4 步进顺控指令及其编程

## 一、使用STL、RET指令的编程方式

步进梯形指令（Step Ladder Instruction）——STL指令

* STL——步进顺控指令（亦称：步进阶梯指令）
* RET——复位指令

STL是步进开始指令，RET是步进结束指令。

| 初始化用   | 一般化用       | 锁存用          | 报警用          |
| ---------- | -------------- | --------------- | --------------- |
| 10点 S0-S9 | 490点 S10-S499 | 400点 S500-S899 | 100点 S900-S999 |

### 编程模型

![image-20231026144414374](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026144414374.png)

状态转移图与梯形图有严格的对应关系。每个状态器有三个功能，即**驱动有关负载**、**指定转移（换）目标**和**指定转移（换）条件**。

![image-20231026150141686](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026150141686.png)

1. STL接点与母线连接。**与STL相连的起始点要使用LD、LDI指令**；
2. **使用STL指令后，LD点移至STL接点的右侧**，一直到出现下一条STL指令或者出现RET指令止。 **RET指令使 LD点返回母线**；
3. 使用STL指令**将新的状态置位**，**前一状态自动复位**。
4. STL指令和RET指令是一对步进（开始和结束）指令。**在一系列步进指令STL后，加上RET指令**，表明步进梯形指令功能的结束，**LD点返回到原来母线**；
5. **STL接点接通后**，与此**相连的电路就可执行**。当STL接点断开时，与此相连的电路停止执行。
6. 在STL接点**接通转为断开**后，还**需要**执行**一个**扫描**周期**。
7. STL步进指令仅对**状态器**有效。但状态器也可以是LD、LDI、AND等指令的目标元件。即，状态器**不作为**步进指令的目标元件时，就具有一般辅助继电器的功能。

#### 注意

1. STL触点可以**直接驱动**或通过**别的触点**驱动Y、M、S、T等元件的线圈，STL触点也可以使Y、M、S等元件置位或复位。
2. CPU**只执行活动步对应的程序**。
3. 使用**STL**指令时**允许双线圈输出**。
4. 在没有并行序列时，一个状态（寄存）器的、STL触点在梯形图中只能出现一次。
5. 在STL触点驱动的电路块中不能使用MC和MCR指令（主控触点指令）。
6. 对状态器中的置位指令，如果**不在**STL触点驱动的**电路块内置位**的时候，系统程序**不会自动将前级步**对应的状态器**复位**。

## 二、状态转移图与梯形图的转换

状态转移图编程时可以将其转换成梯形图，再写出指令表。状态图、梯形图、指令表三者对应关系如下图所示。

M8002在PLC刚启动有效，后面由X4将S0置成ON

![image-20231026151226377](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026151226377.png)

#### 初始状态的编程要特别注意

1. 初始状态可由其它状态器件来驱动，如图中的S23。**最开始运行时，初始状态必须用其它方法来预先驱动**，使之处于工作状态。
2. 初始状态是由PLC从停止→启动**运行切换瞬间**使特殊辅助继电器**M8002接通**，从而**使状态器S0置1（ON）**。
3. 除初始状态器之外，**一般状态器元件必须在其它状态后加入STL指令才能驱动**，不能脱离状态器用其它方式驱动。编程时必须将初始状态器放在其他状态之前。

### 小车控制系统举例

![image-20231026152209199](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026152209199.png)

### 两节皮带运输机控制

![image-20231026152617001](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026152617001.png)

# §5-5 选择性分支与汇合及其编程

## 一、选择性分支与汇合的特点

![image-20231026153514752](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026153514752.png)

1. 从多个分支流程中**选择某一个单支流程**，称之为**选择性分支**；

2. 图例中，X0、X10、X20在同一时刻**最多只能有一个为接通状态**，这一点是必要前提。

   亦即S20动作时，X0一接通，动作状态就向S21转移，S20就变为“0”状态，**在此以后**，即使X10或X20为接通，S31或S41也不会动作（即为“1”状态）；

3. 汇合状态S50，可由S22、S32、S42中**任意一个**驱动。

## 二、选择性分支与汇合的编程

### 1、选择性分支的编程

![image-20231026153722663](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026153722663.png)

选择性分支状态转移图的编程与一般状态图的编程一样，先进行驱动处理，然后设置转移条件，**编程时要由左至右逐个编程**。

### 2、选择性汇合的编程

![image-20231026153938805](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026153938805.png)

选择性汇合的编程要先进行汇合前状态的输出处理，然后朝汇合状态转移，此后由左至右进行汇合转移。

**注意**：分支、汇合的转移处理程序中，**不能用**MPS、MRD、MPP、ANB、ORB指令。



![image-20231026160135230](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026160135230.png)

#### 大小球分类举例

教材P68

1. 左上为原点，动作顺序为：下降、吸收、上升、右行、下降、释放、上升、左行；
2. 机械臂下降时，若电磁铁吸住大球，下限开关LS2断开；若吸住小球，LS2接通。

![image-20231026160536067](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026160536067.png)

![image-20231026160659939](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026160659939.png)

# §5-6 并行性分支与汇合及其编程

## 一、并行性分支与汇合的特点

1. 并行分支是指同时处理的程序流程；
2. 在S20动作后，X0一接通，则S21、S24、S27就同时动作，各分支开始动作；
3. 待各个流程的动作全部结束后，X7接通，汇合状态S30动作,S23、S26、S29全部复位，变为“0”状态。
4. 这种汇合有时被称为排队汇合。

### 2、并行性汇合的编程

![image-20231026161415651](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026161415651.png)

编程与一般状态转移图编程一样，先进行驱动处理，然后进行转移处理。转移处理从左到右依次进行。

注意：STL指令最多只能连续使用8次，相当于并行的只有8个分支。

![image-20231026161258262](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026161258262.png)

# §5-7 分支与汇合的组合及其编程

## 一、不正确的分支与汇合的组合及其处理

### 1、上下分支之间无状态元件

![image-20231026162221071](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026162221071.png)

上述四个状态转移图是不正确的，它们都是在上一个汇合完成到下一个分支开始之间没有状态元件，这样的状态转移图无法执行，需进行修改。

#### 修改方法

是在汇合与分支之间，加入一个**虚拟状态**，使其上一个汇合真正完成后，再进入下一支分支。

![image-20231026162510052](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026162510052.png)

虚拟状态在这里是没有实质性意义，只是从状态转移图的结构上具备合理性。

#### 四种状态转移图的编程

![image-20231026162632040](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026162632040.png)

### 2、流程交叉

![image-20231026162903977](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026162903977.png)

左边的状态转移图也是不正确的，原因是在图中出现了流程交叉。因此，需对该图进行修改。但要注意修改前后其转移图功能不发生改变。其编程程序是不一样。

## 二、正确的分支与汇合的组合及其编程

### 1、选择性分支与汇合交叉并行性分支与汇合

![image-20231026163118482](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026163118482.png)

### 2、并行性分支与汇合交叉选择性分支与汇合

![image-20231026163208203](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026163208203.png)

#### 编制多个单流程状态转移图的原则

1. 初始状态不能重复；
2. 所有通用状态元件不能重复，也不能交叉，但可断续；
3. 系统执行时按照初始状态号由小到大依次进行；
4. 在编制指令表时，应先编制低号初始状态的单流程，完成后再编制高一号的初始状态单流程，以后顺序编制。

## 二、流程跳转

![image-20231026163241577](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026163241577.png)

流程跳转分为单流程内的跳转执行与单流程之间的跳转执行。在编制指令表时，所有跳转均使用OUT指令。 图(a)为单流程跳转，图(b)为一单流程向另一单流程的跳转。

## 三、流程重复（循环）与复位

![image-20231026163536054](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026163536054.png)

复位流程重复指单流程内在某条件下反复执行某段程序的过程。流程复位指当执行到终结时，状态的自动清零。在编制指令表时，流程重复用OUT指令，复位用RST指令，图(c)为重复示例，图(d)为复位示例。

# §5-9 具有多种工作方式系统设计与编程

![image-20231026163707932](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026163707932.png)

#### 自动

1. 连续（全自动循环运行）
2. 单周期（间断周期运行）
3. 回原点（自动运行试车）

#### 手动

1. 调试
2. 自动参数的测定
3. 自动运行时突发情况的状态调整
4. 非标准操作

## 一、梯形图的总体结构

![image-20231026163633529](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231026163633529.png)

其框架在教材P91页处

手动开关X10为ON，将跳过手动程序，执行公用程序和自动程序。选择手动工作方式时，X10为OFF，将跳过自动程序，执行公用程序和自动程序。

### 上节课重点

1. 步进顺控指令STL的使用（编程）；
2. 不正确分支与汇合有哪几种形式？（无状态器、流程的交叉）
3. 状态转移图流程的跳转、重复（或称为：循环）、复位及分支限数的要求和形式；
4. 工程中“**手动/自动**”控制梯形图的**框架结构形式**是怎样的？

## 二、操作面板示意图

1. 为了简化整个设计，各个设备只设置了点动控制。所以，只有启动按钮，而没有停止按钮；
2. 其中启动X0和停止X1，相当于总启和总停。

![image-20231102141300137](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102141300137.png)

## 三、PLC外部接线图

![image-20231102141434004](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102141434004.png)

### 手动程序

<img src="5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102142255335.png" alt="image-20231102142255335" style="zoom: 33%;" />

### 公共程序

![image-20231102142413492](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102142413492.png)

### 顺序功能图

![image-20231102142506611](5.PLC%E6%AD%A5%E8%BF%9B%E9%A1%BA%E6%8E%A7%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102142506611.png)