# 可编程序控制器原理与应用

## 上节课重点

1. 电工学中所学习到的电动机启停等控制：交流接触器——继电器控制，一般称为什么控制？（<u>常规控制</u>）
2. 电气控制系统中涉及到控制的主要控制设备（主控设备）有哪些？（<u>工控机、单片机、PLC、调节控制仪表、I/O卡</u>）
3. 常见的被控制参数（被控参数）有哪些？（<u>温度、压力、流量、转速、阀门开度、相对湿度</u>）
4. 什么是**模拟量**？（<u>连续变化的量</u>）什么是**开关量**？（<u>0断1通</u>）阀门全开全关控制是开关量控制，还是模拟量控制？（<u>开关量</u>）阀门开度控制呢？（<u>模拟量</u>）
5. 工控机、PLC中常常配置有**A/D和D/A转换卡**（模块）。其中A/D（<u>模数转换卡</u>）、D/A（<u>数模转换卡</u>）各称为什么？属于I/O中的哪类卡（<u>输入卡</u>）？其各自的作用是什么？
6. 常规继电器一交流接触器控制中，分**主电路**和**控制电路**，PLC只能完成哪部分功能？（<u>控制电路</u>）
7. I/O地址表、I/O硬件接线图、梯形图之间的关系。（<u>先有地址表，再有硬件接线图和梯形图，硬件接线图和梯形图基本同时</u>）
8. 使用PLC作为主控设备来构成自动控制系统，有何好处？（硬件的部分不需要改动，仅需要改变控制程序，控制过程就改变了；辅助测量）
9. PLC的含义是什么？（<u>可编程序控制器</u>）目前常用的PLC有哪几种品牌？（<u>西门子、欧姆龙、三菱，西门子最贵</u>）
10. **PLC**按其**结构形式来分类**，有哪几种形式？（<u>整体式、模块式、叠装式</u>）
11. PLC有哪几部分组成？（<u>CPU、内存、输入单元、输出单元、编程器、电源</u>）
12. PLC中存储器有哪几种类型？存储器的分类？（系统程序存储器（<u>ROM</u>）；用户程序存储器（<u>RAM</u>）；工作数据存储器（<u>RAM</u>））
13. 常用的开关量输入/输出模块（或单元）有哪几种？（<u>直流输入模块、交流输入模块；输出三个</u>）
14. PLC中的com端是什么端子？（<u>公共接线端</u>）
15. PLC输出加载的是直流电，还是交流电，依据什么来决定？（依据驱动负载的性质来确定）
16. 电动机启停控制，与PLC相连接的输入、输出元件有哪些？各需几个？（必考，2个输入【1个启动1个停止】1个输出；正反转：3个【1个正转1个反转1个停止】输入2个输出；Y-Δ换接启动：2个输入3个输出【KM（主交流接触器）、KM $_Y$ 、KM $_Δ$ 】）
17. 输出com端为什么要分组？（区分性质）。何时可以将多个com合并为一个com端？（一个com用来用一根导线把它们连起来）
18. PLC外部连接按钮后，如何判断哪个是启动钮？还是停止钮？
19. PLC软件结构包括哪些程序？（系统监控程序、用户程序）。系统监控程序包括哪几个部分？
20. PLC程序运行特点或者说采用什么**工作方式**（扫描工作方式）；
21. PLC有哪两种工作状态？（**STOP状态也是什么状态**？）
22. PLC全部输入输出状态的改变，需要多长时间？（一个扫描周期）
23. 对于一台确定的PLC，其**扫描周期长短**，主要取决于什么？（用户程序）
24. PLC中的**软继电器**和常规控制中**硬继电器**的区别；或者说：什么叫软继电器？（硬继电器是真实存在的，软继电器是存储器里的寄存器）
25. PLC梯形图的结构和编程特点；为什么现在画PLC梯形图时，右母线可以允许不画？（因为右母线右边边不允许有其他元件）
26. PLC的编程语言主要有哪几个？（3个：顺序功能图，梯形图，指令表）
27. 在梯形图中，各个触点是可以串联，而**线圈为什么不能串联**，而只能并联？（分压，达不到额定电压无法驱动）
28. 三菱FX系列PLC的**输入**继电器和**输出继电器的编号**（也称为：地址）是怎样分配的？（八进制的）
29. 在梯形图中，有输入继电器（线圈）吗？（没有）
30. 梯形图中的触点通、断，分别对应寄存器（存储器中存储位）的什么状态？（0断开，1接通）
31. PLC中的<u>辅助继电器（M）能直接对外输出信号去驱动负载吗</u>？（不可以，只能作为中介和桥梁去驱动）
32. 断电保持辅助继电器有什么作用？（何时会用到它？）（瞬间掉电时。保证二次来电时仍有输出）
33. 定时器（T）（亦称：计时器）所定时间是怎样给出的？（使用K值赋）
34. 什么叫**通电延时**和**断电延时**？（通电延时：通电信号来的时候，延时一段时间才开始输出；断电延时：按停止的时候，输入不是马上断，过一段时间再断）如何利用定时器来实现通电延时、断电延时？
35. 使用**积分定时器**（断电保持时间继电器）时，应该注意什么？（或者说：为什么要有RST语句（命令）？）（如果没有RST语句会出现积分定时器定的时间到了之后一直有输出的情况，无法停止，除非掉电，必须用reset复位）
36. 使用**计数器**时，为什么也要有一条对应的RST语句？（和上题相同）
37. 程序跳转和子程序调用有什么区别？（或说：什么时候采用程序跳转？什么时候用子程序调用？）（程序跳转：只有两个分支，看条件成立与否走哪条分支；子程序调用：子程序可能会在运行中被多次调用，在原来的程序基础上多出一段，也就是子程序）
38. **怎样看主程序和子程序的分界**？（FEND。FEND和END之间就是子程序，FEND后面的程序就是子程序）
39. 通用数据寄存器和停电保持数据寄存器的区别是什么？（通用数据寄存器如果不存数值进去的话数据就一直保存下来，但断电就没了，停电保持数据寄存器就算断电也保存数据。HR0～HR199）
40. 梯形图绘制基本原则和**常用基本语句的使用**；（从上到下，从左到右。每个输出是一个阶梯，从左母线到右母线）
41. 什么是**连续输出**？（在OUT语句后面通过其他点的串联用于驱动其他输出）
42. 什么叫“块”？（触点组）什么是“**块与**”和“**块或**”操作？（触点组的并联/串联）
43. LD/LDI～OUT一般是配对的。在何情况下，OUT数量会多于LD/LDI？（有连续输出的时候）何情况下，LD/LDI数量又会多于OUT？（有块操作的时候）
44. 边沿检测触发指令有哪几个？（起点的LDP/LDE、与操作的ANDP/ANDF、或操作的ORP/ORF），其引起的输出接通时间有多长？（一个扫描周期）
45. 有时为了避免“块”操作，**对触点多、触点少应如何处理**？（放在前面或者上面）
46. 栈存储器和多重输出指令（MPS-MRD-MPP）的使用。
47. 主控与主控复位指令（MC-MCR）的使用及其执行过程；（主母线可能会断开）
48. 置位和复位指令（SET-RST）的使用（**会画出时序图**），**SET Y0和OUT Y0两条语句的区别**是什么？
49. 如果在梯形图中，出现SET指令，那么可以没有RST指令吗？（语法上没有问题，但是不能停止）**SET和RST优先级哪个高**？（RST高）
50. 脉冲输出指令包括哪两个？有什么区别？（上升沿PLS和下降沿PLF微分输出指令），其输出接通的时间有多长？（一个扫描周期）
51. NOP空操作指令的作用是什么？（1把所有的存储器清零；2当把某一个语句改成NOP后，会改变梯形图的控制功能）
52. 在梯形图中，可以出现多个END语句吗？（可以，但有效的只有第一个）什么时候会出现多个END语句？（在程序分段进行调试的时候）
53. 在梯形图中，可以出现**双线圈**和**桥式电路**吗？（双线圈是不允许的，双线圈前面的触点并联一下就可以；桥式电路，出现能流，一定要把路径打开来）如何处理线圈和桥式电路？
54. 在互锁中，有哪几种互锁（电气硬互锁）？（如果没有互锁）何谓软互锁和硬互锁？（程序上是软互锁，物理上是硬互锁）什么时候需要互锁？（当发觉需要同时启动、得电的时候一定要互锁）仅仅有软互锁行吗？（不可以，正反转必须要硬互锁）
55. **联锁**和**互锁**的区别是什么？（联锁是在时间上的，顺序上的；互锁是指设备间相互制约，一个开的同时另一个就关）
56. 作为停止钮，可以用常闭按钮接入PLC输入端吗？（可以）
57. **定时范围的扩展**是如何实现的？（用计数器把定时器扩展；也可以通过定时器串联来实现定时扩展）
58. 如何用一套启停按钮实现通电延时和断电延时？（作业）
59. 信号灯闪烁控制；
60. 优先抢答电路、译码电路、振荡电路的实现（搞懂第四章第四节P56页的编程实例）；
61. 把书P58页【例4-5】小车往返控制的梯形图弄懂！！
62. 学会和掌握在启停控制的基础上，如何扩展到其它控制程序编写的方法！
63. **状态转移图**（也称：顺序功能图）**的构成和执行过程**；
64. 状态转移图的基本结构有哪几种形式？（单序列，选择性分支与汇合，并行性分支与汇合）
65. 其它机型PLC模仿状态转移图的几个实现方法。（启停；以状态转移改变的）
66. 步进顺控指令STL的使用（编程）；
67. 不正确分支与汇合有哪几种形式？（无状态器、流程的交叉）
68. 状态转移图流程的跳转、重复（或称为：循环）、复位及分支限数的要求和形式；
69. 工程中“**手动/自动**”控制梯形图的**框架结构形式**是怎样的？
70. 功能性指令的表示形式（方形加代码）；
71. **为什么要有功能性指令**？
72. 功能性指令中出现（D）和（P），分别表示什么含义？
73. 32位数据寄存器是如何指定的？
74. **位组合形式K1X0的含义是什么**？（一组四位二进制BCD码组成的一位十进制数）
    如：K1X0=9（1001）→ X3=1，X1=0
75. 怎样利用变址寄存器怎样改变软元件的地址？如K20V，V=6时，其含义是什么？
76. 运算标志（位）和运算出错标志（位）有哪几个？（运算标志位3个）
77. 加法、减法、乘法、除法指令的使用；（注意：①运算结果影响标志位；②**乘法和除法16位和32位问题**；③脉冲型和连续型指令问题）
78. 加1指令（INC）和减1指令（DEC）使用；（①运算结果超限时，影响标志位吗？②使用脉冲型指令多，还是连续型指令多？）
79. 加减乘除四则运算的实现（要特别注意运算过程中16位、32位问题）。
80. PLC输入有一个COM端，**为什么输出通常有多个COM端**？（可能24V驱动可能12V驱动）（可能有同学问：晶体管输出只能带直流负载，是不是其输出只要一个COM端口？）
1. PLC输出口选择连接**哪种电源来驱动负载**，与什么有关？
2. PLC的I/O硬件接线中，**输出接负载时**，应注意什么问题？
3. 三菱PLC的**输入口**每点的电流额定值为多大？输入口信号传递所需的最小电流为多大？
4. 三菱PLC的**输出口**通过的最大电流为多大？如果超过输出端口电流最大值时，应该怎么办？
5. PLC输出驱动负载是线圈（大多数输出需要驱动的交流接触器线圈就是线圈）等**感性负载**时，应注意什么问题？
6. PLC输入输出扩展形式（了解书上介绍的）；一般在什么情况下，需要**输入输出扩展**？
7. 给PLC提供电源，需要**加入隔离变压器**的作用是什么？（电磁隔离，屏蔽噪音）

# §1 概述

### 问题的提出：

1. 电工学中所学习到的电动机启停等控制：交流接触器——继电器控制，一般称为：**常规控制**；
2. 电气控制系统中涉及到控制的主要控制设备——主控设备有哪些？
   * 工控机——工业控制计算机；
   * 单片机；
   * PLC——可编程序控制器；
   * 调节控制仪表——简称：调节器，或控制器。
   * I/O卡——输入输出卡
     * I：输入卡
     * O：输出卡：模拟量输入量，
   * D/A卡——数模转换卡：
     * 数字量（0断1通）
     * 模拟量
   * A/D卡——模数转换卡

### 电动机启停控制

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230914144927432.png" alt="image-20230914144927432" style="zoom:33%;" />

#### 工作原理

$$
\begin{align}
先闭合开关Q，接通电源&。\\\\
按SB1→KM线圈得电&→KM主触头闭合→M运转\\
\searrow&\\
&KM辅助触头闭合→自锁\\\\
按SB2→KM线圈失电&→KM主触头恢复→M停转\\
\searrow&\\
&KM辅助触头恢复→去自锁
\end{align}
$$

控制电路这一部分将完全由PLC来替代！

1. 开关量控制和模拟量控制；
2. 怎样替代？

### 控制电路

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230914143951898.png" alt="image-20230914143951898" style="zoom:33%;" />

#### I/O地址分配表

| 序号 |    项目    | 地址编号 |  功能说明   |
| :--: | :--------: | :------: | :---------: |
|  1   | 开关量输入 |    X0    | 电动机M启动 |
|  2   | 开关量输入 |    X1    | 电动机M停止 |
|  3   | 开关量输出 |    Y0    |   电动机M   |

串行口：RS232；485/422

顺序：I/O地址分配表→I/O硬件接线图→控制梯形图

# 第一章 PLC概述

## §1-1 PLC的发展简历及定义

### 一、PLC的诞生

60年代 继电器接触控制系统。

* 优点：简单、易懂、价格便宜；
* 缺点：硬设备多、接线复杂、改变设计困难。

1968年，美国最大的汽车制造商通用汽车公司（GM），为了适应汽车型号不断更新的需要，提出了十条技术指标在社会上公开招标，制造一种新型的工业控制装置。

1. 容**易编程**；
2. 采用**模块式**结构；
3. **成本**可与继电器控制系统相竞争；
4. 具有**数据通讯**功能；
5. 输入输出**电源**使用市电；
6. 能在**恶劣环境**下工作；
7. **存储**设备可扩充至4K个存储字节；
8. 系统**扩展**时原系统只需很小的改动；
9. **可靠性**高于继电器控制系统；
10. 设备**体积小**于继电器控制柜。

### 二、PLC的定义

1969年美国数字设备公司（DEC）根据招标的要求，研制出世界上第一台可编程序控制器，并在GM公司汽车生产线上首次应用成功。

1980年美国电气制造商协会（NEMA）正式将其命名为：可编程序控制器（Programmable Controller），简称PC。

国际电工委员会（IEC）于1982年11月和1985年1月对可编程序控制器作了如下的定义：

“可编程序控制器是一种数字运算操作的电子系统，**专为在工业环境下应用而设计**。 它采用可编程序的存储器，用来在其内部存储执行逻辑运算、顺序控制、定时、计数和算术运算等操作的命令，并通过数字式模拟式的输入和输出，控制各种类型的机械或生产过程。可编程序控制器及其有关设备，都应按**易于与工业控制系统联成一个整体**，易于扩充功能的原则而设计”。

#### 可编程序控制器（PLC）

* **P**rogrammable
* **L**ogic
* **C**ontroller

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230914160612754.png" alt="image-20230914160612754" style="zoom: 50%;" />

## §1-2 PLC的特点及应用

### 一、PLC的特点

#### 1、优点

1. 可靠性高（平均无故障时间3～5万小时）；
2. 编程简单；
3. 通用性强；
4. 体积小、结构紧凑、安装、维护方便。

#### 2、缺点

1. 主要是PLC的软、硬件体系结构是封闭而不是开放的：如专用总线、通信网络协议，I/O模板不通用，甚至连机柜、电源模板亦各不相同。

2. 编程语言虽然多数是梯形图，但是其组态、寻址、语言结构均不一致，因此各个公司 PLC 互不兼容。

   SIEMENS等公司已经开发出以个人计算机为基础，在Windows操作系统平台下，结合IEC1131-3国际标准的新一代开放体系结构的PLC。

### 二、PLC的应用领域

* PLC在工业自动化中起着举足轻重的作用，在国内外已广泛应用于机械、冶金、石油、化工、轻工、纺织、电力、电子、食品、交通等行业。经验表明，80%以上的工业控制可以使用PLC来完成。
* 在日本，凡8个以上中间继电器组成的控制系统都已采用PLC来取代。

### 三、PLC的发展趋势

1. 向高速度、大存储容量方向发展（CPU处理速度ns级、内存2M字节）
2. 向多品种方向发展和提高可靠性（超大型和超小型）
3. 产品更加规范化、标准化（硬件、软件兼容的PLC）
4. 分散型、智能型、与现场总线兼容的I/O
5. 加强联网和通信的能力
6. 控制的开放和模块化的体系结构OMAC（Open Modular Architecture for Contros）

# §2-1 PLC的分类和基本形式

## 一、PLC按I/O点数分类

* I/O点数小于32为微型PLC；
* I/O点数在32～128为微小型PLC；
* I/O点数在128～256为小型PLC；
* I/O点数在256～1024为中型PLC；
* I/O点数大于1024为大型PLC；
* I/O点数在4000以上为超大型PLC。

以上划分不包括模拟量I/O点数，且划分界限不是固定不变的。

## 二、PLC按结构形式分类

### 1、整体式

又称单元式或箱体式。整体式PLC是将电源、CPU模块、输入输出（I/O）模块都集中装在一个箱状机壳内。一般小型PLC采用这种结构。它包括基本单元和扩展单元。

#### 整体式PLC特点

* 结构紧凑，它可将所有的电路集中在一个模块内，构成一个整体。
* 体积小、重量轻、成本低、安装方便，可直接装入机床或其他设备的电控柜中。
* PLC的产品通常都有不同点数的**基本单元**、**扩展单元**和**扩展模块**三部分搭配使用。
  * 基本单元：内部有CPU与存储器，为必用装置。
  * 扩展单元：需要增加I/O点数时，使用的装置内**无CPU**。
  * 扩展模块：以8为单位增加I/O点数，也可只增加输入数或输出数，因而使I/O的点数比率改变。扩展模块与扩展单元不同，它**内部无电源**，需由基本单元或扩展单元供给电源。

### 2、模块式

将PLC各部分分成若干个单独的模块，如CPU模块、I/O模块、电源模块和各种功能模块。

模块式由框架和各种模块组成。**模块插在底板上**。一般大、中型PLC采用模块式结构，而有的小型PLC也采用这种结构。

#### 模块式PLC特点

* CPU为独立的模块，输入、输出也是独立的模块，**配置很灵活**；
* 可以根据不同的系统规模选用**不同档次**的CPU及各种I/O模块、功能模块。
  * 各种模块以外，还需要用基板（主基板、扩展基板）将各模块联成整体；有多块基板时，则还要用电缆将各基板联在一起。
* 对于I/O点数很多的系统选型，**安装调试、扩展、维修等都非常方便**。

### 3、叠装式

# §2-2 PLC的基本组成

## 一、PLC的硬件结构

### 1、中央处理单元（CPU）

可编程序控制器中，常用的CPU主要采用通用微处理器、单片机和双极型位片式微处理器三种类型：

1. 通用处理器：8080、8086、80286、80386；
2. 单片机芯片：8031、8096；
3. 位片式微处理器：AM2900、AM2901、AM2903。

### 2、存储器

* 随机存取存储器（RAM）：可读可写，没有断电保持功能。
* 只读存储器（ROM）：只读，不能写。
* 可紫外线擦除只读存储器（EPROM）：非易失性。用紫外线照射芯片上的透镜窗口，可以擦除已写入的内容，写入新内容。
* 可电擦除只读存储器（EEPROM）：它是非易失的。具有ROM的非易失性和RAM的随机存取的优点。但价格比较高。

根据存储器在系统中的作用，可以把存储器分为以下3种：

1. 系统程序存储器；
2. 用户程序存储器；
3. 工作数据存储器。

ROM存放**系统**程序

RAM存放**用户**程序、工作数据

### 3、常用的I/O模块（单元）

PLC输入模块的作用是将PLC外部信号送至PLC内部；PLC输出模块是用来驱动控空负载（电磁铁、继电器、接触器线圈等）。

* 开关量输入单元

  * 直流输入单元
  * 交流输入单元

  直流输入单元若输入交流电则会烧毁，交流输入电源若输入直流电仅会不工作。

* 开关量输出单元。

  * 晶体管输出单元
  * 双向晶闸管输出单元
  * 继电器输出单元

$$
三极管\begin{cases}
放大特性\\
开关特性
\begin{cases}
截止\\
饱和
\end{cases}
\end{cases}
$$

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230921144539836.png" alt="image-20230921144539836" style="zoom: 33%;" />

### AD003和DA003与外设之间的连接

<img src="2.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90%E5%8F%8A%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.assets/image-20230921144324431.png" alt="image-20230921144324431" style="zoom: 25%;" />

### I/O模块的外部接线方式

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230921145111179.png" alt="image-20230921145111179" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230921145309308.png" alt="image-20230921145309308" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230921145530768.png" alt="image-20230921145530768" style="zoom: 25%;" />

<img src="2.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90%E5%8F%8A%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.assets/image-20230921150049490.png" alt="image-20230921150049490" style="zoom: 25%;" />

**不同分组端所接负载共用一个电源**，可将所有com端用导线接在一起。

## 二、PLC的软件结构

### 1、系统监控程序

监控程序是PLC成品必须包括的部分，由制造者编制，用于PLC本身的运行。它包括以下几个部分：

* **管理程序**：
  * **运行管理**：进行**时间上的分配管理**。即控制PLC何时输入/输出、运算、自检、通讯。
  * **生成用户元件**：进行**存储空间管理**（即生成用户元件），由它规定各种参数、程序的存放地址，将用户使用的数据参数存储地址转化为实际的数据格式及物理存放地址。它将有限的资源变为用户可直接使用的很方便的元件。
  * **内部自检**：它包括各种系统**出错检验**、用户程序**语法检验**、句法检验、警戒时钟运行等。
* **用户指令解释程序**：PLC是采用梯形图语言编程，需通过用户指令解释程序，将人们易懂的梯形图程序变为（**翻译**）机器能懂的机器语言程序。
* **标准程序模块，系统调用**：是由许多**独立程序块**组成，各自能完成不同功能（完成输入/输出、特殊运算等）。PLC的各种具体工作都是由这部分程序（**特殊指令**）来完成的，这部分程序的多少，将决定了PLC性能强弱。

#### 注意

* 整个系统监控程序是一个整体。
* 监控程序质量的好坏很大程度上影响了PLC的性能。
* 通过改进系统监控程序就可在不增加任何硬设备的条件下大大改善PLC的性能。
* 国外PLC厂家对监控程序的编制非常重视。实际售出的产品中，其监控程序一直在不断地完善。

### 2、用户程序

是供可编程序控制器的使用者，针对**控制问题**所编制的程序。

* 用梯形图或某种PLC指令的助记符编制而成的，可以是**梯形图**、**指令表**、**高级语言**、**汇编语言**等等，其助记符形式随PLC型号不同而不同。
* 线性地存储在监控程序指定的**存储区间**内的。它的最大容量也是由监控程序限制了的。

# §2-3 PLC的工作原理

<img src="2.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90%E5%8F%8A%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.assets/image-20230921152041372.png" alt="image-20230921152041372" style="zoom: 25%;" />

<img src="2.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90%E5%8F%8A%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.assets/image-20230921152752576.png" alt="image-20230921152752576" style="zoom: 25%;" />

* 内部处理：有的将其称为：PLC自诊断阶段
* 通信操作：也叫输入采样。在此阶段，顺序读入所有输入端子的通断状态，并将读入的信息存入内存中所对应的映象寄存器。在此输入映象寄存器被刷新。
* 程序执行：根据梯形图程序扫描原则，按先左后右、先上后下的步序，逐句扫描，执行程序。
* 输出处理：程序执行完毕后，将元件映象寄存器中Y寄存器的状态，在输出处理阶段转存到输出锁存器，通过隔离电路，驱动功率放大电路，使输出端子向外界输出控制信号，驱动外部负载。

### 二、PLC的工作特点

* 输入信号集中批量处理
* 程序集中执行
* 输出信号集中批量处理

### 三、PLC的工作过程

#### 注意：

1. PLC是**“串行”工作**的，这和传统的继电器控制系统的“并行”工作有质的区别。这种串行工作方式避免了继电器接触器控制系统中触点竞争和时序失配的问题。
2. PLC的扫描既可按**固定的顺序进行**，也可按用户程序所指定的**可变顺序进行**。
3. 全部输入输出状态的改变，需要一个扫描周期。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230921152850838.png" alt="image-20230921152850838" style="zoom:25%;" />

<img src="2.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90%E5%8F%8A%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.assets/image-20230921153503973.png" alt="image-20230921153503973" style="zoom: 25%;" />

<img src="2.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90%E5%8F%8A%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.assets/image-20230921153850183.png" alt="image-20230921153850183" style="zoom: 25%;" />

### 四、PLC的扫描周期

$$
\rm T=公共部分扫描时间+外设扫描时间+用户程序执行时间+I/O扫描时间
$$

**用户程序执行时间**：取决于**扫描速度**和**用户程序长短**。小型机一般为十几毫秒到几十毫秒。

毫秒级的扫描时间对于一般工业设备通常是可以接受的，PLC的**响应滞后**是允许的。

但是对某些I/O快速响应的设备，则应采取相应的处理措施。如选用**高速CPU**，提高扫描速度，采用**快速响应模块**、**高速计数模块**以及不同的中断处理等措施减少滞后时间。

PLC的响应滞后是因为其I/O有个响应时间问题。
$$
\rm PLC的I/O响应时间=输入延迟时间+扫描周期+输出延迟时间+输出时间
$$
影响I/O滞后的**主要原因**有：

1. 输入滤波器的惯性；
2. 输出继电器触点的惯性；
3. 程序执行的时间；
4. 程序设计不当的附加影响等。

触点多的放在前面，触点少的放在后面，可以提高**块操作**的效率。

# §2-4 PLC的编程语言

### 梯形图

1. 与继电接触控制系统电路图很相似；
2. 简单直观。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230921160554597.png" alt="image-20230921160554597" style="zoom: 25%;" />

### 指令表

由若干条指令组成的程序叫指令表程序。

<img src="2.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90%E5%8F%8A%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.assets/image-20230921161239530.png" alt="image-20230921161239530" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230921161901162.png" alt="image-20230921161901162" style="zoom: 25%;" />

**指令语句**：由**操作码**和**操作数**两部分组成。（作业中不写步序）

#### 三菱FX系列PLC语句表

| 步序 | 操作码（助记符） | 操作数（参数） | 说明                       |
| :--: | :--------------: | :------------: | -------------------------- |
|  1   |        LD        |       X1       | 逻辑行开始，输人X1动合触点 |
|  2   |        OR        |       Y1       | 并联Y1的自保触点           |
|  3   |       ANI        |       X2       | 串联X2的动断触点           |
|  4   |       OUT        |       Y1       | 输出Y1逻辑行结束           |
|  5   |        LD        |       Y1       | 输入Y1常开触点逻辑行开始   |
|  6   |       OUT        |       Y2       | 输出Y2逻辑行结束           |

用梯形图或指令表方式编程固然广为电气技术人员接受，但对于一个复杂的控制系统，尤其是**顺序控制程序**，由于内部的连锁、互动关系极其复杂，其梯形图往往长达数百行，通常要由熟练的电气工程师才能编制出这样的程序。另外，如果在梯形图上不加上注释，则这种**梯形图的可读性也会大大降低**。

近年来，许多新生产的PLC在梯形图语言之外加上了采用IEC标准的SIC（Sequential Function Chart）语言，用于编制复杂的顺控程序。
$$
顺序功能图\begin{cases}
梯形图\\
功能块图\\
指令表\\
结构文本
\end{cases}
$$
顺序功能图

1. 相当于应用软件中的**逻辑框图**；
2. 是一种位于基它编程语言之上的图形语言；
3. 用来编制**顺序控制**程序。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230921162355101.png" alt="image-20230921162355101" style="zoom: 25%;" />

### 功能块图

类似于**数字逻辑电路**中编程语言，用类似与门、或门等方框图来表示的**逻辑运算关系**。

<img src="2.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90%E5%8F%8A%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.assets/image-20230921162439633.png" alt="image-20230921162439633" style="zoom: 25%;" />

### 结构文本

PASCAL、BASIC、C等高级语言

* 便于实现：
  * 数学运算
  * 数据处理
  * 图形显示
  * 报表打印

# §2-5 梯形图的主要特点

1. 编程元件不是真实的硬件继电器，而是**软件继电器**；
2. 梯形图两侧的公共线称为**公共母线**，分析时，可以假想有一个电流（称为：**能流**）从左向右流动。
3. 程序执行是一个**逻辑解算**的过程。根据梯形图中各触点的状态和逻辑关系，求出各个线圈对应的编程元件的状态；
4. 梯形图中的各编程元件的**常开触点**和**常闭触点**，都可以**无限次使用**；
5. 梯形图中的**线圈**应该放在**最右边**。 且**输出线圈**在从上到下运行过程中，**只能出现一次**。

<img src="2.PLC%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90%E5%8F%8A%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.assets/image-20230921163136125.png" alt="image-20230921163136125" style="zoom: 25%;" />

## 梯形图的编程特点和基本原则

1. **触点**状态有**接通**和**断开**两种状态；
2. 触点可以任意串联和并联，但**继电器线圈只能并联**，不能串联；（当多个继电器线圈串联时，它们的电阻和电感会相互影响，串联也会分压，导致电路参数的改变）
3. 输出元件可以使用**输出**继电器，**中间**继电器，**辅助**继电器；或特殊继电器（如：定时器、计数器）；
4. 每一个梯级从起始的左母线→触点→输出继电器→右母线；
5. 输出元件与右母线之间**不允许有其它元件**。（正是因为这点，右母线可以不画！）

# §3-1 FX系列可编程序控制器

## 一、概述

### TX系列PLC特点

* 是当前国内外最新、最具特色、最具代表性的微型PLC。
* 既可**指令表**编程，又可**梯形图**、SFC**顺序功能图**（或称状态转移图）编程。
* 设置了**高速计数器**，可对来自特定的输入继电器的高频脉冲进行中断处理。
* 除具有数据传送与比较、四则运算与逻辑运算等应用指令系统，还具有输入/输出刷新、中断和**高速处理**指令。
* 对特殊控制方面，不仅具备**模拟量输入输出**控制，而且具有**定位控制**及**PID**系统控制。
* 能方便地与计算机链接，进行**通信**，实现数据交换与管理。

## 二、FX系列PLC型号的含义

$$
FX_{[系列序号]}-[I/O总点数][单元类型][输出形式][特殊品种的区别]
$$

#### 系列序号

0、0S、0N、1、2、2C、1S、1N、2N、2NC

#### I/O总点数

14～256

#### 单元类型

* M——基本单元；
* E——输入输出混合扩展单元及扩展模块；
* EX——输入专用扩展模块；
* EY——输出专用扩展模块。

#### 输出形式

* R——继电器输出；
* T——晶体管输出；
* S——晶闸管输出。

#### 特殊品种的区别

* D——DC电源，DC输入；
* A1——AC电源，AC输入；
* H——大电流输出扩展模块（1A/1点）；
* V——立式端子排的扩展模块；
* C——接插口输入输出方式；
* P——输入滤波器1ms的扩展模块；
* L——TTL输入型扩展模块；
* S——独立端子（无公共端）扩展模块。

例： $\rm FX_{1N}-40MR$ 

## 三、FX系列PLC的家族

* 基本单元（主机）有 $\rm FX_0$ 、 $\rm FX_{0S}$ 、 $\rm FX_{0N}$ 、 $\rm FX_{1}$ 、 $\rm FX_2$ 、 $\rm FX_{2C}$ 、 $\rm FX_{1S}$ 、 $\rm FX_{1N}$ 、 $\rm FX_{2N}$ 、 $\rm FX_{2NC}$ 等9个系列。
* 每个系列又有12、16、32、**40**、48、64、80、128点等不同输入/输出点数的机型。
* 还提供**扩展单元与扩展模块**。扩展单元与扩展模块同样具有输出形式的不同和输入输出点数的变化。
* 每个系列还有**继电器输出**、晶体管输出、晶闸管输出三种输出形式。

## 四、主要性能指标

### 1、硬件指标

* 硬件指标包括一般指标、输入特性和输出特性；
* PLC对环境要求很低，能适应工业现场的恶劣条件。

### 2、软件指标

* 软件指标包括运行方式、速度、程序容量、**元件种类和数量**、**指令类型**等；
* **机型不同其软件指标相差非常悬殊**。这项指标的高低反映可编程控制器的运算规模；
* PLC各种运算功能都是由**指令的种类**和功能决定的。

## 五、编程器

### 1、简易编程器

* 功能：输入和编辑指令表程序；
* 特点：体积很小，价格便宜。

### 2、图形编程器

* 功能：直接生成和编辑梯形图程序；
* 特点：价格高，操作比较麻烦。

## 六、个人计算机程序开发系统

也叫**组态软件**

### 1、功能

* **编制**、**修改**PLC的梯形图**程序**；
* **监视**系统运行，打印、采集和分析数据；
* 适时彩色图形操作器和文字处理器；
* 对工业现场和系统**仿真**；
* **网络**管理器和网络工作站；

### 2、特点

* 可以利用现有的**计算机软件和网络资源**；
* **功能强大**。

# §3-2 FX系PLC的编程软元件

## 一、数据结构与软元件

### 1、数据结构

#### （1）十进制数（字数据）

* 定时器和计教器的设定值K；
* 辅助继电器、定时器、计数器、状态继电器等的编号；
* 定时器和计数器当前值等。

#### （2）二进制数（位数据）

* 十、八、十六进制数、BCD码在PLC内部均以二进制数形态存在；
* 使用外围设备进行系统运行监控显示时，会还原成原来的数制。
* 各类继电器、定时器、计数器的触点及线圈。

#### （3）八进制数

输入继电器：输出继电器的地址编号采用八进制。

#### （4）十六进制数

指定应用指令中的操作数或指定动作。

#### （5）BCD码

* 十进制数以BCD码的形态出现；
* 常用于BCD输出形式的数字式开关或七段码显示器控制等方面。

#### （6）常数 K、H

* 十进制常数K是定时器、计数器的设定值；
* 十进制常数K与十六进制常数H也是应用指令的操作数。

### 2、软元件和软继电器

* PLC的**输入输出端子**及内部存储器的**每一个存储单元**均称为**软元件**，简称元件。
* **各个元件**与PLC的监控程序、用户的应用程序合作，会产生或模拟出**不同的功能**。
* 当元件产生的是继电器功能时，称这类元件为**软继电器**，简称继电器。它**不是**物理意义上的**实物继电器**，而是一定的存储单元与程序的结合产物。后述的各类<u>继电器、定时器、计数器、指针均为此类软元件</u>。
* **元件的数量及类别**是由PLC监控程序规定的，它的规模决定着PLC整体功能及数处理能力。

## 二、输入继电器（X）

### 注意

* 输入继电器是PLC内部**虚拟**继电器。它不是物理意义上的实物继电器；
* 在PLC内部**与输入端子相连**；
* 有无数个与之相对应的常开触点和常闭触点。这些动合、动断**触点可在PLC编程时随意使用**；
* 这种输入继电器**不能用程序驱动**，只能由输入信号驱动。

输入继电器是PLC接收外部输入的开关量的窗口。PLC通过光电耦合器**将外部输入的开关量信号读入并存储在输入映像寄存器内**。

#### 外部触点接通时

* 对应的寄存器为“1”状态
* 常开触点闭合，常闭触点断开

#### 外部触点断开时

* 对应的寄存器为“0”状态
* 常开触点断开，常闭触点闭合

### 注意

* **输入继电器**在梯形图里是**没有线圈**的；
* 输入继电器状态取决于外部输入信号的状态。

## 三、输出继电器（Y）

* 输出继电器是将PLC的输出信号传递给输出模块；
* 由输出模块**驱动外部负载**工作。

### $\rm FX_{2N}$ 系列PLC输入输出继电器元件号

| 型号               | 输入          | 输出          |
| ------------------ | ------------- | ------------- |
| $\rm FX_{2N}-16M$  | X0-X7 8点     | Y0-Y7 8点     |
| $\rm FX_{2N}-32M$  | X0-X17 16点   | Y0-Y17 16点   |
| $\rm FX_{2N}-48M$  | X0-X27 24点   | Y0-Y27 24点   |
| $\rm FX_{2N}-64M$  | X0-X37 32点   | Y0-Y37 32点   |
| $\rm FX_{2N}-80M$  | X0-X47 40点   | Y0-Y47 40点   |
| $\rm FX_{2N}-128M$ | X0-X77 64点   | Y0-Y77 64点   |
| 扩展时             | X0-X267 184点 | Y0-Y267 184点 |

## 四、辅助继电器（M）

* 辅助继电器是用**软件实现**的；
* 它们**不能**直接对外输出信号去**驱动负载**；
* 相当于继电器控制系统中的**中间继电器**。
  * 通用：500点（M0～M499）无断电保持功能
  * 断电保持：524点（M500～M1023）有断电保持功能（一个扫描周期的导通）（参见教材P25：例图3-3）
  * 特殊用：256点（M8000～M8255）
    1. 运行监视（M8000）：当PLC运行时，M8000接通；PLC停止运时，M8000断开。
    2. 初始化脉冲（M8002）：在M8000由OFF变为ON状态时的一个扫描周期ON。
    3. 时钟脉冲（M8011～M8014）：M8011~M8014分别是10ms、100ms、1s和1min时钟脉冲。
    4. 锂电池电压降低（M8005）：电池电压下降至规定值时M8005变为ON。

## 五、内部状态继电器（S）

内部**状态**继电器是用于编制**顺序控制**程序的一种编程元件。
$$
\begin{align}
初始状态&&&\rm S0～S9&10点\\
返回原点&&&\rm S10～S19&10点\\
通用状态&&&\rm S20～S499&480点\\
保持状态&&&\rm S500～S899&400点\\
报警器用&&&\rm S900～S999&100点
\end{align}
$$

#### 注意

* S0～S499：没有断电保持功能；
* S500～S899：有断电保持功能。 

## 六、定时器（T）

### 1、通用定时器

#### 100ms定时器

* T0～T199
* 定时范围为0.1～3276.7s （其中T192~T199为子程序和中断服务程序专用的定时器）

#### 10ms定时器

* T200～T245
* 定时范围为0.1～327.67s

#### 注意

**通用定时器没有保持功能**，在输入电路断路或停电时复位。

* 输入信号**接通**后**延时**动作——称为：**通电延时** 
  * 注意：T40是定时100ms（即0.1s）
* 输入信号**断开**后**延时**动作——称为：**断电延时**

### 2、积分定时器

教材上称为：积算定时器

#### 1ms定时器

* T246～T249
* 定时范围为0.001～32.767s

#### 100ms定时器

* T250～T255
* 定时范围为0.1～3276.7s

#### 注意

**积分定时器具有断电保持功能**；断电后再次通电，计数器继续定时。

必须要有复位语句，复位X2断开之后才能停止输出。

## 七、计数器（C）

$$
\begin{cases}
内部计数器
	\begin{cases}
	16位加计数器\\
	32位加/减计数器
	\end{cases}\\
高速计数器
\end{cases}
$$

#### 增计数

* 一般用：100点（16bit）C0～C99
* 锁存用：100点（16bit）C100～C199

#### 增减计数用

* 一般用：20点（32bit）C200～C219 
* 锁存用：15点（32hit）C220～C234

#### 高速用

* 一相60KHz 4点，二相30KHz 1点，5KHz 1点

根据本课程要求，只要求掌握16位计数器

X11不是按钮，是光电开关。

## 八、内部指针（P/I）

$$
\begin{cases}
\rm 分支用指针(P)
	\begin{cases}
	跳转用指针\\
	子程序调用指针
	\end{cases}\\
\rm 中断用指针(I)
\end{cases}
$$

根据本课程要求，只要求掌握分支用指针

分支用 P0～P127 128点

### 分支指令用指针

* **分支指令**用指针在应用时，要与相应的应指令FNC00（CJ）、FNC01 （CALL）、FNC06 （FEND）、FNC02（SRET）及END配合使用，**完成程序**执行流向的**跳转**、**调用子程序**、结束等；
* 分支指令用指针是为了给上述的这些应用指令提供**跳转地址**（目标）或称**跳转标号**。其中**P63**较特殊，它是直接跳转到END指令的指针；
* P0～P62、P64～P127，共127点；
* P63用于结束跳转到END位置，故**不能使用P63作标志**。

## 九、数据寄存器（D）

* PLC用于**模拟量**控制、**位置量**控制、**数据**I/O时，需要许多**数据寄存器存储参数**及工作数据。
* 这类寄存器数量随机型的不同而不同。 较简单的只能进行**逻辑控制**的机器**没有此类寄存器**，而高档机中，可达数千个。
* 每一个数据寄存器都是**16位**（最高位为符号位）；
* 可以用**两个数据寄存器**，合并起来存放32位数据（最高位为符号位）。

### 1、通用数据寄存器

* D0～D199（200点）；
* 只要**不写入**其他数据，则**已写入的数据不会变化**。
* PLC状态由**运行（RUN）→停止（STOP）**时，通用数据寄存器全部数据均**清零**。
* 若将特殊辅助继电器**M8033**置1，在PLC由RUN转为STOP时，数据可以保持。

### 2、停电保持数据寄存器

* D200～D511（312点）；
* **除非改写**，否则原有数据不会丢失；
* 不论电源**接通与否**，PLC运行与否，其内容也**不变化**。
* 在两台PLC作点对点的**通信**时，**D490～D509**被用作通信操作。

### 3、特殊数据寄存器

* D8000～D8255（256点）；
* 这些数据寄存器供**监控PLC**中各种元件的**运行**方式之用；
* 寄存器的内容在电源**接通**（ON）时，**写入初始化值**（全部先清零，然后由系统ROM安排写入初始值）。

【例】D8000所存放警戒监视时钟（watchdog timer）的时间是由系统ROM设定的。要改变时，用传送指令将目的时间送入D8000。该值在运行(RUN)→停止(STOP)时，保持不变。

* **没有定义**的特殊数据寄存器，请用户**不要使用**。

### 4、文件寄存器

* D1000～D2999（2000点）；

* 文件寄存器实际上是一类**专用**数据寄存器，用于**存储大量的数据**；

  例如：采集数据、统计计算数据、多组控制参数等

* 其**数量**由CPU的监控软件决定，但可以通过扩充存储卡的方法加以**扩充**。

* 文件寄存器是要**占用用户程序存储器**（RAM、EEPROM、EPROM）内的一个存储区，以500点为一个单位，最多可在参数设置时设置2000点，用**编程器**可进行**写入**操作。

#### 注意

* 在PLC运行中，可用**BMOV**指令将文件寄存器中的**数据读到通用数据寄存器**中去，但不能用指令将数据写入文件寄存器。
* 在数据寄存器中如果存放**32位**数据且**指定了低位**（例如：D0），则**高位**为继其之后的编号（例如：D1）**被自动占有**。

## 十、常数（K、H）

$$
\rm PLC使用的常数
\begin{cases}
十进制常数\rm\ K\\
十六进制常数\rm\ H
\end{cases}
$$

常数一般用于

* 定时器或计数器的设定值和当前值；
* 应用指令的操作数。

### 绘制梯形图的基本原则

1. 梯形图按**从上到下**，**从左到右**的顺序绘制；
2. 每个继电器为一个逻辑行，即一层阶梯。**每个逻辑行起于左母线**，终于右母线；
3. 继电器线圈与右母线直接连接，**不能在继电器线圈与右母线之间接其它元件**；
4. 在梯形图中，同一继电器的常开、常闭**触点可以多次被使用**，不受限制。但同一个继电器线圈，在程序运行中只能用（出现）一次。

# §4-1 FX系列PLC的基本逻辑指令（27条）

## 一、LD、LDI、OUT指令

* LD（Load）：常开触点与母线连接指令；
* LDI（Load Inverse）：常闭触点与母线连接指令；
* OUT（Out）：驱动线圈的输出指令。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230928162150280.png" alt="image-20230928162150280" style="zoom: 50%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230928162313438.png" alt="image-20230928162313438" style="zoom:50%;" />

1. 在用指令来表示梯形图时，其**程序步是不需要**输入的；
2. 一般情况下，**LD**（LDI）和**OUT**是**成对出现**的。如果不成对出现，则有特殊情况出现。

## 二、AND、ANI指令

* AND（And）：与指令，常开触点串联连接指令；
* ANI（And Inverse）：与非指令，常闭触点串联连接指令。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230928162503331.png" alt="image-20230928162503331" style="zoom: 33%;" />
$$
\boxed{\begin{align}
&\rm LD&&\rm X0\\
&\rm AND&&\rm M101\\
&\rm OUT&&\rm Y3\\
&\rm LD&&\rm Y3\\
&\rm ANI&&\rm X3\\
&\rm OUT&&\rm M101\\
&\rm AND&&\rm T1\\
&\rm OUT&&\rm Y5
\end{align}}
$$
在OUT指令后面，通过触点可将数据输出至其它线圈，即通过触点去驱动其它线圈，称为：**连续输出**。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230928163528815.png" alt="image-20230928163528815" style="zoom:33%;" />

必须用多重输出MPS、MRD、MPP指令。

## 三、OR、ORI指令

* OR（OR）：常闭触点的并联连接指令
* ORI（OR Inverse）：常闭触点的并联连接指令。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230928163855735.png" alt="image-20230928163855735" style="zoom:33%;" />

OR、ORI指令可以多次并联连接。在下面的这个梯形图中，也存在所谓的“**逻辑块**”问题。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20230928164254673.png" alt="image-20230928164254673" style="zoom: 50%;" />

前面的例子是要进行逻辑“**块或**”操作，而这里将需要进行逻辑“**块与**”操作。

## 四、ORB指令

* **ORB**（OR Block）：电路块（**逻辑块**）并联连接指令。
* **串联电路块**：两个以上的触点串联连接而成的电路。有时也称为：**触点组**

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007143310441.png" alt="image-20231007143310441" style="zoom: 25%;" />

#### “块或”的编程方法

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007143432634.png" alt="image-20231007143432634" style="zoom: 25%;" />

## 五、ANB指令

* **ANB**（And Block）：逻辑块串联连接指令

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007143609888.png" alt="image-20231007143609888" style="zoom: 25%;" />

### “块与”的编程方法

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007143753321.png" alt="image-20231007143753321" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007144422931.png" alt="image-20231007144422931" style="zoom: 25%;" />

### 编程技巧

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007144634322.png" alt="image-20231007144634322" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007145319353.png" alt="image-20231007145319353" style="zoom: 25%;" />

## 六、边沿检测触发指令

* LDP/LDF、ANDP/ANDF、ORP/ORF 指令都是触点指令，这些指令的用法和LD、AND、OR相同，只是所表达的触点的功能有所不同。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007145523409.png" alt="image-20231007145523409" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007145737869.png" alt="image-20231007145737869" style="zoom: 25%;" />

## 七、栈存储器和多重输出指令

* **MPS**（Push）：**进栈**指令；
* **MRD**（Read）：**读栈**指令；
* **MPP**（Pop）：**出栈**指令。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007150020714.png" alt="image-20231007150020714" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007150534169.png" alt="image-20231007150534169" style="zoom: 25%;" />

### 注意

1. MPS、MRD、MPP这组指令的功能是将**连接点的结果存储起来**，以方便连接点后面电路的编程；
2. PLC中有11个存储运算中间结果的存储器，它们被称为：**栈存储器**。
3. 使用一次MPS命令，该时刻的运算结果就推入**栈的第一段**。当再次使用MPS时，当时的运算结果将推入栈的第一段，先推入的数据依次向栈的下一段推移。
4. **MRD**是最上段所存的最新数据的**读出**专用指令。**栈内的数据不发生下压或上移**。
5. 使用MPP指令，各数据依次向上段推移（称为：**弹出**或**出栈**）。最上段数据在读出后就从栈内消失。
6. 多重输出指令都是没有操作元件号的指令。
7. MPS与MPP必须**成对使用**。
8. 由于栈存储器仅有11个，所以MPS与MPP连续使用**次数必须少于11次**。（若多于11次，怎么办？）

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007150854478.png" alt="image-20231007150854478" style="zoom: 25%;" />

### 举例

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007151133959.png" alt="image-20231007151133959" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007151508429.png" alt="image-20231007151508429" style="zoom: 25%;" />

#### 一层栈电路（教材P46）

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007151716148.png" alt="image-20231007151716148" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007152130249.png" alt="image-20231007152130249" style="zoom: 25%;" />

#### 二层栈电路

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007152331571.png" alt="image-20231007152331571" style="zoom: 25%;" />

#### 四层栈电路

教材P47：相当于MPS和MPP嵌套。最多11层。其也可以用“连续输出”来编程。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007152528101.png" alt="image-20231007152528101" style="zoom: 25%;" />

## 八、主控与主控复位指令

* **MC**（Master Control）：主控指令或公共触点串联连接指令；
* **MCR**（Master Control Reset）：主控复位指令

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007152849676.png" alt="image-20231007152849676" style="zoom: 25%;" />

### 注意

* 使用主控指令的触点称为**主控触点**，在梯形图中与一般触点相垂直。
* 在使用主控触点后，相当于母线移到主控触点的后面。
* 如果 MC 指令的输入触点断开时，**积算定时器计数器**用复位/置位指令驱动的软元件，**保持其当时的状态**；**非积算定时器**和用**OUT**驱动的元件变为**OFF**。
* **无嵌套**时，用**N0编程**；有嵌套时，N的编号次序增大。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007153350115.png" alt="image-20231007153350115" style="zoom: 25%;" />

#### 主控、主控复位指令的嵌套

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007153707909.png" alt="image-20231007153707909" style="zoom: 25%;" />

## 九、置位和复位指令

* **RST**（Reset）：复位指令，使操作保持复位的指令。
* **SET**（Set）：置位指令，使操作保持的指令。

#### 说明：

1. 在任何情况下，**RST指令都优先执行**。
2. 计数器和移位寄存器处于复位状态下，不接收输入的数据。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007155756854.png" alt="image-20231007155756854" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007160429355.png" alt="image-20231007160429355" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007160805332.png" alt="image-20231007160805332" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007162018202.png" alt="image-20231007162018202" style="zoom:25%;" />

## 十、脉冲输出指令

* **PLS**：**上升沿微分输出指令**。用于将指定信号的上升沿进行微分，并将微分结果送给PLS指令后面所指的目标软元件。
* **PLF**：下降沿微分输出指令。

#### 注意

* 使用**PLS**指令，元件Y、M仅在驱动输入**接通**（上升沿触发）后的一个扫描周期内动作（置1）。
* 使用**PLF**指令，元件Y、M仅在驱动输入**断开**（下降沿触发）后的一个扫描周期内动作（置1）。
* 特殊继电器不能使用PLS或PLF的操作元件。
* 在驱动输入接通时，PLC由运行→停机→运行，此时PLS M0动作，但**PLS M600（断电后由电池后备的辅助继电器）不动作**。这是因为M600是保持继电器，即使在断电停机时，其动作也能保持。

## 十一、空操作指令与结束指令

* **NOP**（Non Processing）：空操作指令。
  1. 用户存储器清零后，用户存贮器内容全部变为NOP（零）；
  2. 主要用于短路电路、改变电路功能及调试程序时用；
  3. 程序如果加入NOP，改动或追加程序时，可以减少序号的改动。另外，**用NOP指令替换已写入的指令，也可改变电路**；
* **END**（End）：结束指令，表示程序结束。
  1. 若在程序最后写入END，则END以后的程序将不再执行。
  2. **按段插入END**，可以**顺序扩大对各程序段的检查**，方便调试程序。

#### 注意：P54

在一个比较大的程序里，如果想删除掉某一语句，又怕以后可能还要改回来，就可以**将要删除的语句用NOP来替换**。否则，一旦删除后，可能就不容易找到在什么位置删除了语句。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231007163639618.png" alt="image-20231007163639618" style="zoom: 25%;" />

# §4-2 基本电路与梯形图设计方法

## 一、启动、保持和停止电路（启保停——启停控制)

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012141506254.png" alt="image-20231012141506254" style="zoom: 50%;" />

#### 【注意】

**启停控制电路是最基本的电路**。对于**初学者**来说，大多控制程序都是通过在启停控制程序的基础上逐渐添加相关触点发展而来！（千万要记住这个技巧）

## 二、三相异步电动机正反转控制电路

热继电器FR个数跟着电动机个数走！

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012141844349.png" alt="image-20231012141844349" style="zoom:25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012143250532.png" alt="image-20231012143250532" style="zoom: 33%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012143404198.png" alt="image-20231012143404198" style="zoom: 50%;" />

### 2、正反转控制梯形图

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012143800163.png" alt="image-20231012143800163" style="zoom:50%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012143549917.png" alt="image-20231012143549917" style="zoom:50%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012144344620.png" alt="image-20231012144344620" style="zoom:25%;" />

### 3、常闭触点输入信号的处理

启停控制

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012144845592.png" alt="image-20231012144845592" style="zoom: 50%;" />

改成常闭按钮的话，再按启动按钮，电机无法启动。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012145526467.png" alt="image-20231012145526467" style="zoom:33%;" />

## 三、定时器和计数器的应用程序

定时范围的扩展

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012145627993.png" alt="image-20231012145627993" style="zoom:33%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012150035054.png" alt="image-20231012150035054" style="zoom: 50%;" />

**自复位定时器**：用定时器自身的触点把自己断掉。

**「问」**

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012150443355.png" alt="image-20231012150443355" style="zoom: 33%;" />

【小结】怎样设计梯形图？

1. 从启停控制梯形图开始；
2. 再看启动的有哪些？停止的又有哪些？把相应的启动和停止的部分加入进去即可。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012150735098.png" alt="image-20231012150735098" style="zoom: 50%;" />

要求：按下停止按钮，延时0.6s后停车！

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012151001688.png" alt="image-20231012151001688" style="zoom:33%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012151202711.png" alt="image-20231012151202711" style="zoom:33%;" />

再看启动的有哪些？停止的又有哪些？把相应的启动和停止的部分加入进去即可。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012151259922.png" alt="image-20231012151259922" style="zoom:33%;" />

**「思考题」**如果按启动按钮，过10s后再起动；按停止按钮，5s后再停止，梯形图怎样改动？

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012151712074.png" alt="image-20231012151712074" style="zoom:33%;" />

### 闪烁电路（书上没有）

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012152138137.png" alt="image-20231012152138137" style="zoom:33%;" />

T1作动时间应该为一个扫描周期。

### 接通/断开延时电路（书上没有）

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012152604252.png" alt="image-20231012152604252" style="zoom:33%;" />

T1动作最短处为一个扫描周期。

## 四、其它编程案例

教材P57

### 优先（抢答）电路

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012160440165.png" alt="image-20231012160440165" style="zoom: 50%;" />

输入信号X0（A）或输入信号X1（B）中**先到**者将取得**优先**权，而后者无效。

【问】这个梯形图有问题吗？（缺复位按钮）

### 译码电路

#### 真值表

$$
\begin{array}{c|c}
\hline X0\quad X1&Y0\quad Y1\quad Y2\quad Y3\\
\hline1\qquad1&1\qquad0\qquad0\qquad0\\
\hline0\qquad0&0\qquad1\qquad0\qquad0\\
\hline0\qquad1&0\qquad0\qquad1\qquad0\\
\hline1\qquad0&0\qquad0\qquad0\qquad1\\\hline
\end{array}
$$

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012161203419.png" alt="image-20231012161203419" style="zoom:50%;" />

#### 真正的真值表

$$
\begin{array}{c|c}
\hline X0\quad X1&Y0\quad Y1\quad Y2\quad Y3\\
\hline0\qquad0&1\qquad0\qquad0\qquad0\\
\hline0\qquad1&0\qquad1\qquad0\qquad0\\
\hline1\qquad0&0\qquad0\qquad1\qquad0\\
\hline1\qquad1&0\qquad0\qquad0\qquad1\\\hline
\end{array}
$$

### 二分频电路

该电路可以实现对输入信号的二分频，输出**Y0**是输入**X0**的**二分频**。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012161716148.png" alt="image-20231012161716148" style="zoom:50%;" />

### 振荡电路

当X0闭合后，下面的三种振荡电路均产生周期为3s的振荡信号。

#### 「例1」

利用**自复位定时器的一种变形**来实现的。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012161954790.png" alt="image-20231012161954790" style="zoom: 50%;" />

#### 「例2」

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012162156460.png" alt="image-20231012162156460" style="zoom:50%;" />

这种振荡程序，在实际上用的很少。因为从宏观上说，Y0似乎一直是有输出的。

#### 「例3」

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012162723350.png" alt="image-20231012162723350" style="zoom:50%;" />

# §4-3 梯形图的经验设计方法

在一些典型电路的基础上，根据被控对象对控制系统的具体要求，不断修改和完善梯形图，多次反复调试和修改梯形图的设计方法。

#### 特点

1. 具有试探性和**随意性**；
2. 最后的**结果不是唯一的**；
3. 设计所用的时间和质量因**设计者的经验**而异。

## 设计实例一

送料小车在限位开关X4处**装料**，10s后结束然后右行；碰到X3后停下来**卸料**，15s后左行，碰到X4后，又停下来装料，这样不停地循环工作，直到按下停机按钮。

#### 【注意】

1. 输入有哪几个？（行程开关X3和X4；还有呢？启动一个,
   停止一个？行了吗？）
2. 输出有哪几个？定时器呢？

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012163013204.png" alt="image-20231012163013204" style="zoom:50%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012163258939.png" alt="image-20231012163258939" style="zoom:50%;" />

## 设计实例二

两处卸料的小车自动控制系统梯形图设计

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012163544781.png" alt="image-20231012163544781" style="zoom:50%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231012164044326.png" alt="image-20231012164044326" style="zoom:50%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019142025547.png" alt="image-20231019142025547" style="zoom:50%;" />
$$
硬互锁和软互锁
$$

#### 【程序设计方法】

程序设计**最简单有效的方法**是在启停控制基础上，逐渐增加所需的控制功能：

1. 有哪些启动和停止的？
2. 需要不需要：时间控制？互锁？联锁？

### 多设备联锁控制

多节皮带运输机、锅炉的鼓风机和引风机等等控制，都存在所谓的**联锁控制**。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019143705907.png" alt="image-20231019143705907" style="zoom:50%;" />

1. 这里的鼓风机和引风机需要不需要**互锁**？
2. 引风机启动8s后，鼓风机才启动；停止时，鼓风机停止5s后，引风机才停止，程序如何改动？

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019145751497.png" alt="image-20231019145751497" style="zoom: 25%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019150055481.png" alt="image-20231019150055481" style="zoom:25%;" />

## 设计实例三

教材P58【例45】 

小车在初始状态时**停在中间**，限位开关X0为ON。按下启动按钮X3，小车按图所示顺序往复运动，按下停止按钮X4，小车停在初始位置。 需注意的是，所有的限位开关以及按钮开关以常开触点接入PLC接线端。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019150331745.png" alt="image-20231019150331745" style="zoom:33%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019150809204.png" alt="image-20231019150809204" style="zoom: 50%;" />

## PLC控制系统的一般设计步骤

1. **了解**被控设备的**工艺**流程和机械的动作情况（了解工艺控制要求）；
2. **确定**PLC的**输入**信号和**输出**负载，画出外部接线图（确定输入输出点数）；
3. 确定时间继电器、中间继电器、定时器（**这些继电器都没有外部接线**）；
4. 根据对应关系画出梯形图程序：**从启停开始**。

# §5-1 梯形图的顺序控制设计法

## 一、用经验设计法设计梯形图存在的问题

### 经验设计法

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019151607153.png" alt="image-20231019151607153" style="zoom:33%;" />

1. 设计方法很难掌握，设计周期长；
2. 装置交付使用后维修困难。（相对而言，要看编程者熟练程度）

### 另类法

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019151655818.png" alt="image-20231019151655818" style="zoom:33%;" />

### 第三种方法

就是本章要介绍的：**顺序控制**设计方法！

## 二、顺序控制设计法的基本思想

#### 步（状态）STEP

将系统的一个工作周期或一个控制过程划分成若于个顺序相连的阶段，这些阶段称为：**步（状态）**

#### 转换

1. 状态与状态之间由**转换分隔**；
2. 相邻的状态具有不同的动作。

#### 转换条件

1. 使系统由前级步进入下一步的信号称为：**转换条件**。
2. 当相邻两状态之间的转换条件满足时，就实现转换。

#### 有向线段

#### 动作或命令

每一步所完成的工作

# §5-2 顺序控制设计中的功能表图

## 一、概述

**功能表图**（Function Chart），也称为：**状态转移图**或**顺序功能图**，它是描述控制系统的控制过程、功能和特性的一种图形。

状态转移图具有直观、简单的特点，是设计PLC顺序控制程序的一种工具。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019152111754.png" alt="image-20231019152111754" style="zoom:33%;" />
$$
内部状态继电器
$$

## 二、状态转移图的绘制

1. **状态器用框图表示**，框内是状态器元件号；
2. 状态器之间用**有向线段**连接；
3. 其中从上到下、从左到右**箭头可以省去不画**；
4. 有向线段上的垂直短线和它旁边标注的文字符号或逻辑表达式表示**状态转移条件**，旁边的线圈等是**输出信号**。

Y1和Y2输出的不同：（1）Y1是用OUT指令驱动；（2）Y2是用SET指令置位，未复位前Y2一直保持接通。

1. 状态器**S20有效时**，输出Y1、Y2接通；
2. 程序等待转换条件X1动作；
3. 当X1一接通，状态就由S20转到S21，这时Y1断开，Y3接通，**Y2仍保持接通**。

### 举例

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019152600754.png" alt="image-20231019152600754" style="zoom:50%;" />

1. 机械手将工件从A点向B点移送；（教材P64）。
2. 机械手的上升、下降与左移、右移都是由**双线圈两位电磁阀驱动气缸**来实现的。抓手对物件的松开、夹紧是由二个**单线圈**两位电磁阀驱动气缸完成，只有在电磁阀通电时抓手才能夹紧；
3. 该**机械手工作原点在左上方**，按下降、夹紧、上升、右移、下降、松开、上升、左移的顺序依次运行。

S2为**初始**状态，用**双线框**表示。当辅助继电器M8041、M8044接通时,状态从S2向S20转移，下降输出Y0动作。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019153258980.png" alt="image-20231019153258980" style="zoom:50%;" />

### 举例

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019161247152.png" alt="image-20231019161247152" style="zoom:50%;" />

M8002在PLC刚启动时导通一个扫描周期

## 三、状态转移图的基本结构

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019162023202.png" alt="image-20231019162023202" style="zoom:50%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019162214059.png" alt="image-20231019162214059" style="zoom:50%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019162415287.png" alt="image-20231019162415287" style="zoom:50%;" />

### 举例

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019162804079.png" alt="image-20231019162804079" style="zoom:50%;" />

这是一个**三工位**钻床的工作台的俯视图

三个工位分别完成：

1. 送料（装工件）；
2. 钻孔；
3. 合格品检测，卸工件。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019162615762.png" alt="image-20231019162615762" style="zoom:67%;" />

## 四、状态转移图中转换实现的基本原则

功能表图中表示**活动状态的进展是由转换实现来完成的**。

### 1、转换实现的条件

1. 该转换的前级步是**活动步**；
2. 相应的转换条件得到满足。

### 2、转换实现应完成的操作

1. 将有向线段与相应转换符号相连的**后续步都变成活动步**；
2. 将有向线段与相应转换符号相连的**前级步都变成不活动步**。

## 五、状态转移图的特点

1. **两个步**绝对不能直接相连，必须用一个**转换**将它们**隔开**；
2. **两个转换**也不能直接相连，必须用一个**步**将它们**隔开**；
3. 功能表中的**初始步**一般对应于系统等待**启动的初始状态**，它是必不可少的；
4. 自控系统应能**多次重复执行**同一工艺过程，因此功能表图中应该是一个由有向线段组成的**闭环**；
5. 如果用**没有断电保持**功能的编程元件代表各步，PLC在开始进入RUN工作方式时，它们均处于断开状态，所以**必须用M8002**（特殊辅助继电器（初始脉冲））**的常开触点作为转换条件**，将初始步预置为活动步。

# §5-3 顺序控制梯形图的编程方式

## 一、使用启保停电路的编程方式

### 编程模型

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019163637363.png" alt="image-20231019163637363" style="zoom: 50%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019163755329.png" alt="image-20231019163755329" style="zoom:50%;" />

## 二、以转换为中心的编程方式

### 编程模型

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231019164045824.png" alt="image-20231019164045824" style="zoom:50%;" />

### 路旁手控信号灯控制系统举例

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026143839114.png" alt="image-20231026143839114" style="zoom:50%;" />

# §5-4 步进顺控指令及其编程

## 一、使用STL、RET指令的编程方式

步进梯形指令（Step Ladder Instruction）——STL指令

* STL——步进顺控指令（亦称：步进阶梯指令）
* RET——复位指令

STL是步进开始指令，RET是步进结束指令。

| 初始化用   | 一般化用       | 锁存用          | 报警用          |
| ---------- | -------------- | --------------- | --------------- |
| 10点 S0-S9 | 490点 S10-S499 | 400点 S500-S899 | 100点 S900-S999 |

### 编程模型

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026144414374.png" alt="image-20231026144414374" style="zoom:50%;" />

状态转移图与梯形图有严格的对应关系。每个状态器有三个功能，即**驱动有关负载**、**指定转移（换）目标**和**指定转移（换）条件**。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026150141686.png" alt="image-20231026150141686" style="zoom:50%;" />

1. STL接点与母线连接。**与STL相连的起始点要使用LD、LDI指令**；
2. **使用STL指令后，LD点移至STL接点的右侧**，一直到出现下一条STL指令或者出现RET指令止。 **RET指令使 LD点返回母线**；
3. 使用STL指令**将新的状态置位**，**前一状态自动复位**。
4. STL指令和RET指令是一对步进（开始和结束）指令。**在一系列步进指令STL后，加上RET指令**，表明步进梯形指令功能的结束，**LD点返回到原来母线**；
5. **STL接点接通后**，与此**相连的电路就可执行**。当STL接点断开时，与此相连的电路停止执行。
6. 在STL接点**接通转为断开**后，还**需要**执行**一个**扫描**周期**。
7. STL步进指令仅对**状态器**有效。但状态器也可以是LD、LDI、AND等指令的目标元件。即，状态器**不作为**步进指令的目标元件时，就具有一般辅助继电器的功能。

#### 注意

1. STL触点可以**直接驱动**或通过**别的触点**驱动Y、M、S、T等元件的线圈，STL触点也可以使Y、M、S等元件置位或复位。
2. CPU**只执行活动步对应的程序**。
3. 使用**STL**指令时**允许双线圈输出**。
4. 在没有并行序列时，一个状态（寄存）器的、STL触点在梯形图中只能出现一次。
5. 在STL触点驱动的电路块中不能使用MC和MCR指令（主控触点指令）。
6. 对状态器中的置位指令，如果**不在**STL触点驱动的**电路块内置位**的时候，系统程序**不会自动将前级步**对应的状态器**复位**。

## 二、状态转移图与梯形图的转换

状态转移图编程时可以将其转换成梯形图，再写出指令表。状态图、梯形图、指令表三者对应关系如下图所示。

M8002在PLC刚启动有效，后面由X4将S0置成ON

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026151226377.png" alt="image-20231026151226377" style="zoom:50%;" />

#### 初始状态的编程要特别注意

1. 初始状态可由其它状态器件来驱动，如图中的S23。**最开始运行时，初始状态必须用其它方法来预先驱动**，使之处于工作状态。
2. 初始状态是由PLC从停止→启动**运行切换瞬间**使特殊辅助继电器**M8002接通**，从而**使状态器S0置1（ON）**。
3. 除初始状态器之外，**一般状态器元件必须在其它状态后加入STL指令才能驱动**，不能脱离状态器用其它方式驱动。编程时必须将初始状态器放在其他状态之前。

### 小车控制系统举例

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026152209199.png" alt="image-20231026152209199" style="zoom: 50%;" />

### 两节皮带运输机控制

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026152617001.png" alt="image-20231026152617001" style="zoom: 50%;" />

# §5-5 选择性分支与汇合及其编程

## 一、选择性分支与汇合的特点

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026153514752.png" alt="image-20231026153514752" style="zoom:33%;" />

1. 从多个分支流程中**选择某一个单支流程**，称之为**选择性分支**；

2. 图例中，X0、X10、X20在同一时刻**最多只能有一个为接通状态**，这一点是必要前提。

   亦即S20动作时，X0一接通，动作状态就向S21转移，S20就变为“0”状态，**在此以后**，即使X10或X20为接通，S31或S41也不会动作（即为“1”状态）；

3. 汇合状态S50，可由S22、S32、S42中**任意一个**驱动。

## 二、选择性分支与汇合的编程

### 1、选择性分支的编程

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026153722663.png" alt="image-20231026153722663" style="zoom:33%;" />

选择性分支状态转移图的编程与一般状态图的编程一样，先进行驱动处理，然后设置转移条件，**编程时要由左至右逐个编程**。

### 2、选择性汇合的编程

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026153938805.png" alt="image-20231026153938805" style="zoom: 50%;" />

选择性汇合的编程要先进行汇合前状态的输出处理，然后朝汇合状态转移，此后由左至右进行汇合转移。

**注意**：分支、汇合的转移处理程序中，**不能用**MPS、MRD、MPP、ANB、ORB指令。



<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026160135230.png" alt="image-20231026160135230" style="zoom: 50%;" />

#### 大小球分类举例

教材P68

1. 左上为原点，动作顺序为：下降、吸收、上升、右行、下降、释放、上升、左行；
2. 机械臂下降时，若电磁铁吸住大球，下限开关LS2断开；若吸住小球，LS2接通。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026160536067.png" alt="image-20231026160536067" style="zoom:50%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026160659939.png" alt="image-20231026160659939" style="zoom: 33%;" />

# §5-6 并行性分支与汇合及其编程

## 一、并行性分支与汇合的特点

1. 并行分支是指同时处理的程序流程；
2. 在S20动作后，X0一接通，则S21、S24、S27就同时动作，各分支开始动作；
3. 待各个流程的动作全部结束后，X7接通，汇合状态S30动作,S23、S26、S29全部复位，变为“0”状态。
4. 这种汇合有时被称为排队汇合。

### 2、并行性汇合的编程

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026161415651.png" alt="image-20231026161415651" style="zoom: 50%;" />

编程与一般状态转移图编程一样，先进行驱动处理，然后进行转移处理。转移处理从左到右依次进行。

注意：STL指令最多只能连续使用8次，相当于并行的只有8个分支。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026161258262.png" alt="image-20231026161258262" style="zoom: 50%;" />

# §5-7 分支与汇合的组合及其编程

## 一、不正确的分支与汇合的组合及其处理

### 1、上下分支之间无状态元件

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026162221071.png" alt="image-20231026162221071" style="zoom: 50%;" />

上述四个状态转移图是不正确的，它们都是在上一个汇合完成到下一个分支开始之间没有状态元件，这样的状态转移图无法执行，需进行修改。

#### 修改方法

是在汇合与分支之间，加入一个**虚拟状态**，使其上一个汇合真正完成后，再进入下一支分支。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026162510052.png" alt="image-20231026162510052" style="zoom:50%;" />

虚拟状态在这里是没有实质性意义，只是从状态转移图的结构上具备合理性。

#### 四种状态转移图的编程

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026162632040.png" alt="image-20231026162632040" style="zoom:50%;" />

### 2、流程交叉

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026162903977.png" alt="image-20231026162903977" style="zoom:50%;" />

左边的状态转移图也是不正确的，原因是在图中出现了流程交叉。因此，需对该图进行修改。但要注意修改前后其转移图功能不发生改变。其编程程序是不一样。

## 二、正确的分支与汇合的组合及其编程

### 1、选择性分支与汇合交叉并行性分支与汇合

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026163118482.png" alt="image-20231026163118482" style="zoom:50%;" />

### 2、并行性分支与汇合交叉选择性分支与汇合

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026163208203.png" alt="image-20231026163208203" style="zoom:50%;" />

#### 编制多个单流程状态转移图的原则

1. 初始状态不能重复；
2. 所有通用状态元件不能重复，也不能交叉，但可断续；
3. 系统执行时按照初始状态号由小到大依次进行；
4. 在编制指令表时，应先编制低号初始状态的单流程，完成后再编制高一号的初始状态单流程，以后顺序编制。

## 二、流程跳转

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026163241577.png" alt="image-20231026163241577" style="zoom:50%;" />

流程跳转分为单流程内的跳转执行与单流程之间的跳转执行。在编制指令表时，所有跳转均使用OUT指令。 图(a)为单流程跳转，图(b)为一单流程向另一单流程的跳转。

## 三、流程重复（循环）与复位

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026163536054.png" alt="image-20231026163536054" style="zoom:50%;" />

复位流程重复指单流程内在某条件下反复执行某段程序的过程。流程复位指当执行到终结时，状态的自动清零。在编制指令表时，流程重复用OUT指令，复位用RST指令，图(c)为重复示例，图(d)为复位示例。

# §5-9 具有多种工作方式系统设计与编程

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026163707932.png" alt="image-20231026163707932" style="zoom:50%;" />

#### 自动

1. 连续（全自动循环运行）
2. 单周期（间断周期运行）
3. 回原点（自动运行试车）

#### 手动

1. 调试
2. 自动参数的测定
3. 自动运行时突发情况的状态调整
4. 非标准操作

## 一、梯形图的总体结构

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231026163633529.png" alt="image-20231026163633529" style="zoom:50%;" />

其框架在教材P91页处

手动开关X10为ON，将跳过手动程序，执行公用程序和自动程序。选择手动工作方式时，X10为OFF，将跳过自动程序，执行公用程序和自动程序。

## 二、操作面板示意图

1. 为了简化整个设计，各个设备只设置了点动控制。所以，只有启动按钮，而没有停止按钮；
2. 其中启动X0和停止X1，相当于总启和总停。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102141300137.png" alt="image-20231102141300137" style="zoom:50%;" />

## 三、PLC外部接线图

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102141434004.png" alt="image-20231102141434004" style="zoom:50%;" />

### 手动程序

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102142255335.png" alt="image-20231102142255335" style="zoom: 25%;" />

### 公共程序

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102142413492.png" alt="image-20231102142413492" style="zoom: 50%;" />

### 顺序功能图

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102142506611.png" alt="image-20231102142506611" style="zoom:50%;" />

* **基本指令**是基于继电器、定时器、计数器类软元件，主要用于**逻辑功能**处理的指令。
* **步控指令**用于顺序逻辑控制系统。
* **功能指令**主要用于**数据的传送**、**运算**、**变换**及**程序控制**等功能。在工业自动化控制领域中，许多场合是需要数据运算和特殊处理。

三菱FX系列PLC的功能指令用功能符号**FNC00～FNC◻◻◻**表示，各条指令有相对应的助记符表示其功能意义。

例如：**FNC12**，表示的助记符号为：**MOV**（其指令含义为数据传送）

功能编号（FNC）与助记符是一一对应的。不同型号的FX系列PLC，其所拥有的功能指令条数不相等。

# §6-1 功能指令的表示形式及含义

## 一、功能指令的表示形式

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102143457525.png" alt="image-20231102143457525" style="zoom:50%;" />

* 方框为功能框，分别含有功能指令的名称和参数，参数可以是相关数据、地址或其他数据
* X0是执行该条指令的条件

$$
\rm(D0)+123\to(D2)
$$

当X0合上后（可称：X0为ON或X0=1），数据寄存器DO的内容加上123（十进制），然后送数据寄存器D2中。

## 二、功能指令的含义

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102143648113.png" alt="image-20231102143648113" style="zoom:50%;" />

* ①为**功能代号**（FNC）：每条功能指令都有一固定的编号，功能指令代号从FNC00～FNC246。
* ②为**助记符**：是该条指令的英文缩写词。如加法指令用英文缩写为ADD。
* ③为**数据长度**（D）指示：功能指令中大多数涉及到数据运算和操作，而数据的表示以字长表示,有16位和32位之分。因此，<u>有（D）表示的即为32位数据操作指令，无（D）表示的则为16位数据操作指令</u>。
* ④为**脉冲/连续执行指令标志**（P）： 功能指令中若带**有（P）**，则为脉冲执行指令，即**当条件满足时仅执行一个扫描周期**。若指令中没有（P）则为连续执行指令。
* ⑤为某些**特殊指令连续执行的符号**。如果为加1指令，则该指令为连续执行的加1指令，每一扫描周期“源”的内容都发生变化。
* ⑥为**操作数**： 即功能指令所涉及的参数（或称数据）。

#### 「例」

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102143953790.png" alt="image-20231102143953790" style="zoom:50%;" />

1. 16位数据操作，即将（D10）的内容传送到（D12）中
2. 32位数据操作，即将（D21，D20）的内容传送到（D23，D22）中

##### 脉冲执行指令在数据处理中是很有用的

* 加法指令在脉冲形式指令执行时，加数和被加数做一次加法运算，而连续形式指令执行时，每一个扫描周期都要相加一次。
* 某些特别指令，如：加1指令FNC24（INC）、减1指令FNC25（DEC）等。在用连续执行指令时应特别注意，它在每个扫描周期，其结果内容均在发生着变化。

#### 注意

操作数分为：源操作数、目标操作数、其他操作数

1. **源操作数**：是指功能指令执行后，不改变其内容的操作数，用**S**表示。
2. **目标操作数**：是指功能指令执行后，将其内容改变的操作数，用**D**表示。
3. **其他操作数**：既不是源操作数，又不是目标操作数，则称为：其它操作数，用m、n表示。 **其它操作数往往是常数**， 或者是对源、目标操作数进行补充说明的有关参数。表示常数时，一般用K表示十进制数，H表示十六进制数。

#### 注意

1. 在一条指令中，源操作数、目标操作数及其他操作数都可能不止一个（也可以一个也没有），此时均可以用序列数字表示，以示区别。例如S1、S2、...；D1、D2、….；m1、m2、…..；n1、n2....
2. 操作数若是间接操作数，即通过变址取得数据，则在功能指令操作数旁加有一点“•”，例如：[S1•]、[S2•]、[D1•]、[D2•]、[m1•]等。
3. **操作数可使用PLC内部的各种位元件**，例如：X、Y、M、S等，也可以用这些位元件的组合，以**KnX**，**KnY**，**KnM**，**KnS**等形式表示。
4. 数据**寄存器D**，或**定时器T**，或**计数器C**的**当前值**寄存器也**可作为操作数**。
5. 一般数据寄存器为16位，在处理32位数据时，将使用一对数据寄存器组合。 例如将数据寄存器D0指定为32位指令的操作数时，则**（D1，D0）中的D1为高16位，D0为低16位**。T、C的当前值寄存器也可作为一般寄存器处理，其方法同数据寄存器。
6. 计数器**C200～C255**为**32位**数据寄存器，使用过程中**不能**当作16位数据进行操作。

### 脉冲型、连续执行型指令图例

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102150144466.png" alt="image-20231102150144466" style="zoom: 67%;" />

# §6-2 功能指令的分类与操作数说明

## 一、功能指令的分类

共14个分类

#### 程序流程指令

例如CJ（条件跳转）、CALL（子程序调用）等；

#### 传送与比较指令

例如MOV（传送）、CMP（比较）、ZCP（区间比较）等；

#### 四则运算指令

例如ADD（二进制加法）、SUB（二进制减法）、NEG（求补码）等；

#### 循环移位指令

例如ROR（循环右移）、ROL（循环左移）、SFIR（位右移）、SFTL（位左移）等；

#### 数据处理指令

例如ZRST（批次复位）、DECO（译码）、SQR（BIN开方运算）等；

#### 高速处理指令

例如REF（输入/输出刷新）、MTR（矩阵输入）、PLSY（脉冲输出）等；

#### 方便指令

例如IST（初始化）、SER（数据查找）、SORT（数据排序）等；

#### 外围设备（I/O）指令

例如TKY（数字键0～9输入）、HKY（16键输入）、FROM（BFM读出）、TO（BFM写入）；

#### 外围设备（SER）指令

例如RS（串形数据传送）、PRUN（数据传送）、PLID（PLID运算）、CCD（校验码）；

#### 浮点数指令

例如 EADD（二进制浮点加法）、EMUL（二进制浮点乘法）、ECMP（二进制浮点数比较）、INT（浮点取整数）等。

#### 定位指令

例如ABS（ABS值读出）、PLSV（可变速的脉冲输出）、DRVI（相对定位）、DRVA（绝对定位）。

#### 时钟指令

例如：TCMP（时钟数据比较）、TRD（时钟数据读出）、TNR（时钟数据写入）等。

#### 外围设备指令

例如：GRY（格雷码变换）、RD3A（模拟块读出）WR3A（模拟块写入）等。

#### 接点比较指令

例如：LD=（两数相等）、LD<>（两数不等）、LD>（S1大于S2）、LD<（S1小于S2）等。

## 二、功能指令操作数说明

功能指令在数据处理和运算过程中，均要用到有关**数据寄存器**、**变址寄存器**、**中断指针**和**特殊辅助继电器**等，对这些功能指令的操作数，在编程使用过程中，要很好地了解和掌握它，并按有关规则使用。

### 1、数据寄存器与位组合数据

#### （1）数据寄存器（D）

* 数据寄存器是用于存储数值数据的；

* 其值可通过应用指令、数据存取单元及编程装置进行读出或写入。

* 数据寄存器都是16位（最高为符号位），可处理的数值范围为-32768～+32767；

* 两个相邻数据寄存器可组成32位数据存储器（最高位为符号位），可处理的数值范围为-2147483648～+2147483647；

* 在进行32位操作时，只要指定低位编号即可，例如D0。而高位则为继其之后的编号（即为D1），即自动占有。

  低位地址号可以是奇数或偶数，由于考虑到外围设备的监视功能，建议**低位**的编号**采用偶数**编号。

  例如：用DO表示（D1，D0）32位数据寄存器的编号。

* 数据寄存器又分一般型、停电保持型和特殊型。

##### 注意

1. 一般型数据寄存器一旦写入数据，只要不再写入其他数据，其内容就不会变化。但在PLC从运行到停止时或停电时，所有数据将清零。只有一种情况例外，若特殊辅助继电器M8033为ON，则数据可以保持。
2. 利用外围设备的参数设定，可改变 $\rm FX_{2N}$ 、 $\rm FX_{2NC}$ PLC的一般型与停电保持型的分配（除停电保持专用的寄存器以外）。若将停电保持专用数据寄存器作为一般用途时，则需要在程序起始步使用RST或ZRST指令（批次复位，即：区间复位）清除其内容。
3. 在使用PLC与计算机PC间连接通讯的情况下，有一部分的数据寄存器将被链接地址所占用。

#### （2）位组合数据

在FX系列PLC中，均是使用4位BCD码来表示1位十进制数据。这样对于位元件来讲，4位一个组合，表示一个十进制数。所以在功能指令中，常用KnX、KnY、KnM、KnS这种位组合形式表达一个数。

##### 例如

教材P82：如果是K1X10，则是哪几个输入继电器组合？

* K1 X0：由X3～X0，4个输入继电器的组合。
* K2 X0：由X7～X0，8个输入继电器的组合。
* K3 Y0：由Y13～Y10、Y7～Y0，12个输出继电器的组合。
* K4 Y0：由Y17～Y10、Y7～Y0，16个输出继电器的组合。

### 2、变址寄存器（V、Z）

#### （1）变址寄存器的形式

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102153120091.png" alt="image-20231102153120091" style="zoom:50%;" />

* 变址寄存器同普通的数据寄存器一样，是进行数据读出、写入的寄存器，字长为16位，共有16个，分别为V0～V7和Z0～Z7。如图（a）。
* 变址寄存器在功能指令操作中，可以与其他的软元件编号或数值组合使用。V、Z自身也可以组合成32位数据寄存器。如图（b）
* 变址寄存器的内容，与软元件组合，可以改变软元件的地址。可以利用变址寄存器变址的软元件是X、Y、M、S、K、KnX、KnY、KnM、KnS 等。例如：V＝6，K20V则为K26（K20+6）；若V=7，K20V变为K27（K20+7）。

##### 举例

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102153252274.png" alt="image-20231102153252274" style="zoom:50%;" />

* 当V=9、Z=12时：D5V=D5+9=D14；D10Z=D10+12=D22。所以，
* 当X0=1时，则（D14）→（D22）。
* 当V=8时，则D5+8=D13，（D13）→（D22）

#### （2）变址寄存器有关参数的修改

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102153715580.png" alt="image-20231102153715580" style="zoom: 50%;" />

### 3、标志位

（教材P85）

功能指令在操作过程中，其运算结果要影响某些特殊继电器或寄存器，通常称其为标志（位）。标志（位）又分一般标志（位）、运算出错标志（位）和功能扩展用标志（位）。

#### （1）一般标志（位）

在功能指令操作中，其结果将影响下列标志位：

* M8020：零标志，如运算结果为0时动作；
* M8021：借位标志，减法时被减数不够减时动作；
* M8022：进位标志，如运算结果发生进位时动作；
* M8029：指令执行结束标志。

这些标志在各种指令每次执行完毕后，将根据结果使它们接通或断开。

#### （2）运算出错标志（位）

如果在功能指令的结构、可用软元件及其编号范围等方面有错误时，或在运算过程中出现错误，下列标志位会动作，同时记录出错信息。

* M8067：运算出错标志；
* D8068：运算错误代码编号存储（应该是：D8067，**无锁存**）；
* D8069：错误发生的步序号记录存储。

在PLC由STOP→RUN时都是瞬间清除，若出现运算错误，则M8068（运算出错**锁存**）保持动作，而D8068（存储步序号**锁存**）中存储发生错误的步序号。

### 4、分支指针P

指针是用作跳转、中断等程序的入口地址，与跳转、子程序、中断程序等指令一起应用。地址号采用十进制分配。

按其用途来分，可分为分支用指针（P）和中断用指针（I）两类。

分支用指针P是用于条件跳转指令、子程序调用指令的入口地址。其地址号分别为P0～P62（63点）和P0～P127（127点）。而其中的P63为跳转结束指针，相当于END指令。

#### 注意

* 在编程时，指针号不能重复使用；
* P63是跳转结束指针，在程序中不编程，如图所示；

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102161324005.png" alt="image-20231102161324005" style="zoom:33%;" />

* P63是使用FNC00（CJ）指令时，意味着向END跳转的特殊指针。因此，在一般情况下，若用P63作为编程的地址时，程序会发生错误。

# §6-3 功能指令说明

## 一、跳转指令说明

### 1、条件跳转指令FNC00（CJ）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102161506477.png" alt="image-20231102161506477" style="zoom: 50%;" />

#### （2）指令说明

下图为条件跳转指令在梯形图中的具体应用格式。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102161626963.png" alt="image-20231102161626963" style="zoom: 50%;" />

* 若X0为ON，程序跳转到标号P8处，X0为OFF，则顺序执行程序，这称为有条件转移。如果执行条件使用M8000，那么称之为无条件跳转，因为M8000为常闭触点（即PLC一旦启动就闭合）。
* 一个标号只能出现一次，多于一次则会出错。两条跳转指令可以使用同一标号。使用CJ（P）跳转指令时,跳转只执行一个扫描周期。
* 编程时，标号占一行，对有意向END步跳转的指针P63编程时，程序中不要对标号P63编程。所以，左边的指令编程是错误的。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102161803568.png" alt="image-20231102161803568" style="zoom:50%;" />

* 在程序运行时，当X0为OFF时，程序正常运行。X1=0，Y0=1；X2=1，当T0定时2.5s后，Y1=1；X3=0时开始计数器清零，C0计5次，Y2=1。

* 若X0为ON时，则跳转到P63（END）处，使继电器输出，而定时器、计数器值均保持不变。

  此时，若X0为OFF时（P89页为“ON”错误），又继续执行程序，继电器输出根据输入条件动作，而定时器和计数器则继续往下定时或计数。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102162045107.png" alt="image-20231102162045107" style="zoom:50%;" />

#### 举例：自动/手动方式切换编程

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102162358001.png" alt="image-20231102162358001" style="zoom:50%;" />

### 2、子程序调用指令

#### FNCO1 （CALL）-FNCO2 （SRET）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102162929861.png" alt="image-20231102162929861" style="zoom:50%;" />

#### （2）指令说明

* FNCO1（CALL）为子程序调用指令，其操作数对 $\rm FX_{05}$ 、 $\rm FX_{0N}$ 、 $\rm FX_{1s}$ 、  $\rm FX_2$ PLC来说，其指针为P0～P62。 $\rm FX_{1N}$ 、 $\rm FX_{2N}$ 、 $\rm FX_{2NC}$ PLC的指针从P0～P127，P63为END标号，不作指针，标号在程序中仅能使用一次。

* CALL指令在程序中的基本使用格式如下图所示。

  子程序调用CALL指令一般安排在主程序中，主程序的结束有FEND（主程序结束）指令。在子程序的开始端有P××指针，最后由SRET返回指令返回主程序。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102163210757.png" alt="image-20231102163210757" style="zoom:50%;" />

* X0为调用子程序的条件。当X0为ON时，则调用P10～SRET段子程序，并执行。

  当X0为OFF时，程序顺序执行，子程序不执行。

* 子程序调用最多可嵌套5级。

* 子程序P11的调用因采用CALL（P）指令，是脉冲执行方式，所以在X0由OFF→ON时，仅调用P11子程序执行一次。P11子程序执行时，当若X11=1时，又要调用 P12子程序并执行，当P12 子程序执行完毕后，又返回到P11原断点处执行P11子程序，当执行到SRET①处，又返回到主程序。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102163400029.png" alt="image-20231102163400029" style="zoom:67%;" />

#### 举例：子程序调用编程

* 应用子程序调用指令，可以优化程序结构，提高编程效果。
* 当X1为OFF时，若X0为ON时，调用PO（1s）子程序执行； 若 X0 为OFF时，调用 P1（2s）子程序执行；
* 当X1为ON时，不调用P0、P1子程序，而调用P2（4s）子程序执行。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102163529784.png" alt="image-20231102163529784" style="zoom:50%;" />

### 3、主程序结束指令FNC06 （FEND）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102163658458.png" alt="image-20231102163658458" style="zoom:50%;" />

#### （2）指令说明

FEND作为主程序的结束指令。执行此命令，功能同END。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231102163845431.png" alt="image-20231102163845431" style="zoom:50%;" />

### 4、循环指令FNCO8 （FOR）/FNC09（NEXT）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109143423446.png" alt="image-20231109143423446" style="zoom:50%;" />

#### （2）指令说明

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109143631953.png" alt="image-20231109143631953" style="zoom:50%;" />

* **FOR**为循环开始指令，**NEXT**为循环结束指令。这两条指令必须是**成对出现**的。

  在上图，使用了FOR-NEXT 三次循环（即A、B、C）

* 循环次数n在1～32767时有效，如果n为-32767～0时，则n将当作1处理。

* 上图中，如果n=K4，则此FOR-NEXT循环执行四次；

* 如果n=D0Z为6时，则对应的FOR-NEXT循环执行为6次；如果n=K1X0为7时，则对应的FOR-NEXT循环执行七次。因此在上图程序中，将一共执行：4×6×7=168次。

* FOR-NEXT循环次数一共可以**嵌套5层**；

* **循环次数多时，PLC的扫描周期会延长**，有可能出现大于监视定时器指定的数值，有时会出错，所以编程时要注意这一情况。

* 编写程序时，若NEXT指令编写在FOR指令之前，或FOR指令无对应的NEXT 指令，或在FEND、END 指令以后再有 NEXT指令，或FOR 指令与NEXT指令的个数不相等时，都会出错。

* FOR-NEXT**需要成对出现，否则会出错**。

## 二、传送、比较指令说明

传送、比较指令共有10条，如下表所示。 表中的指令对 $\rm FX_{2N}$ 、 $\rm FX_{2NC}$ PLC来说均适用，而对其它FX系列PLC是有选择性的。应用时可根据机型选择，这类指令在程序中使用是十分频繁的。

### 1、比较指令FNC10（CMP）/FNC11（ZCP）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109144223445.png" alt="image-20231109144223445" style="zoom:50%;" />

#### （2）指令说明

##### a、比较指令FNC10（CMP）

* 比较指令是将源操作数[S1]、[S2]的数据进行比较，比较结果送到目标操作数[D]中；
* 比较的数据均为一进制数比较，且是带符号位比较，例如：-5<2；
* 比较的结果影响目标操作数（Y、M、S），若把目标操作数指定其他继电器（例如：X、D、T、C），则会出错。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109144416011.png" alt="image-20231109144416011" style="zoom:50%;" />

* 如上图：**当X0为OFF，不执行CMP指令，M0、M1、M12保持不变**；当X0为ON时，[S1]、[S2]进行比较，即C20计数器值与K100（数值100）比较。若C20当前值小于100，则M0=1，Y0=1；若C20当前值等于100，则M1=1,Y1=1；若C20当前值大于100，则M2=1，Y2=1。
* 如果Y0=1,、而X0=0时，则Y0有输出保持不变。若要清除比较结果时，则需要用RST和ZRST复位指令。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109144600951.png" alt="image-20231109144600951" style="zoom:50%;" />

* X0为ON，C30的当前值与K100和K120比较，若C30<100时，则M3=1，Y0=1；若100≤C30≤120时，则M4=1,Y1=1；若C30>120时，则M5=1，Y2=1。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109145303562.png" alt="image-20231109145303562" style="zoom:50%;" />

#### 举例：比较指令应用

比较指令应用如图所示。

当X0=1时，若C0计数器计数的个数小于10时，即C0<10，Y0=1；计数器C0=10时，Y1=1；当计数器C0>10时，Y2=1。当计数器C0计数到15时，此时Y3为ON。

1. 正常情况下，此处在N0=0时，应对Y0～Y2进行复位；
2. 计数器C0的编程有问题吗？

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109150002433.png" alt="image-20231109150002433" style="zoom:50%;" />

X1为ON，当计数器C1计数个数为如下数值时，Y4、Y5、Y6将有相应的状态。

1. C1<10，Y4=1；
2. 10≤ C1≤20, Y5=1;
3. C1>20，Y6=1。

Y11为内部秒脉冲M8013的输出。当计数器C1=30时，C1清零，在下一个扫描周期，PLC又开始循环工作。不难看出，Y4、Y5、Y6三输出（ON）间隔均为10s，Y11则为秒脉冲输出指示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109150226039.png" alt="image-20231109150226039" style="zoom:50%;" />

### 2、传送指令FNC12（MOV）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109150319987.png" alt="image-20231109150319987" style="zoom:50%;" />

#### （2）指令说明

* 下图所示为传送指令的基本格式，MOV指令的功能是将源操作数送到目标操作数中，即当X0为ON时，[S]→[D]。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109150414469.png" alt="image-20231109150414469" style="zoom:50%;" />

* 指令执行时，K100十进制常数自动转换成二进制数。

  当X0断开时，指令不执行，D10数据保持不变。

* MOV指令为连续执行型，MOV(P)指令为**脉冲执行**型。编程时若[S]源操作数是一个变数，则要用脉冲型传送指令MOV(P)。但这要看（D10）里是不是也需要变，如果需要，这不能加（P）

（D）MOV D0 D10 的含义：

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109150541880.png" alt="image-20231109150541880" style="zoom:50%;" />

* 对于32位数据的传送，需要用（D）MOV指令，否则用MOV指令会出错，如下图所示为一个32位数据传送指令。
* 当X0合上，则（D1，DO）→（D11，D10）；当X1合上，则（C235）32位计的数→（D21，D20）

#### 举例：传送指令应用

MOV指令在定时器、计数器指令中的应用实例如下图所示。图中所示是读出计数器C0的当前值送D20中。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109150827740.png" alt="image-20231109150827740" style="zoom:50%;" />

下图中，是将 K200→D12中，K200即表示T20的定时数值。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109151058573.png" alt="image-20231109151058573" style="zoom:50%;" />

如将PLC输入端X0～X3的状态送到输出端Y0～Y3，可用MOV指令编写程序。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109151431080.png" alt="image-20231109151431080" style="zoom:50%;" />

也就是说上面两个梯形图实际上是等价的。

注意：如果用MOV（P），还等价吗？

有关位传送、块传送、多点传送类指令，以及数据交换和BCD码变换等指令，课后自学教材P104～P110

## 三、四则逻辑运算指令说明

 $\rm FX_{2N}$ 、 $\rm FX_{2NC}$ PLC四则逻辑运算指令共有10条。

### 1、加法指令FNC20（ADD）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109151755283.png" alt="image-20231109151755283" style="zoom:50%;" />

#### （2）指令说明

加法指令是将指定的源元件中的二进制数相加，结果送到指定的目标元件中去。加法指令功能说明如下图所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109152101932.png" alt="image-20231109152101932" style="zoom:50%;" />

当执行条件XO由OFF→ON时，（D10）+（D12）→（D14）。运算是代数运算，例如5+(-8)=-3

#### 注意

1. 加法指令操作时影响3个常用标志位，即M8020零标志、M8021借位标志、M8022进位标志。
   * 如果运算结果为0，则**零标志M8020**置1；
   * 如果运算结果小于-32767（16位）或-2147483647（32位），则**借位标志M8021**置1；
   * 如果运算结果超过32767或2147483647，则**进位标志M8022**置1。
2. 在**32位运算**中，被指定的字元件是**低16位**元件，而下一个元件为高16位元件。
3. **源和目标可以用相同的元件号**。若源和目标元件号相同而采用**连续执行**的ADD、（D）ADD指令时，加法的结果在每个扫描周期都会改变。
4. 若指令使用脉冲执行型时，当X1每从OFF→ON变化时，D0的数据加1，这与INC（P）指令的执行结果相似。其不同之处在于用ADD指令时，零位、借位、进位标志按上述方法置位（即影响标志位）。

### 2、减法指令FNC21（SUB）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109152418784.png" alt="image-20231109152418784" style="zoom:50%;" />

#### （2）指令说明

减法指令是将指定的源元件中[S1]、[S2]的二进制数相减，结果送到指定的目标[D]中，即[S1]-[S2]→[D].减法指令功能说明如下图所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109152556950.png" alt="image-20231109152556950" style="zoom:50%;" />

* （a）图：当X0为ON时，（D10）-（D12）→（D14），只执行一次运算，且为16位指令运算；
* （b）图：连续执行的32位减法指令运算，即当X0为0N时，（D11，D10）-（D13，D12）→（D15，D14），且连续执行。运算是代数运算，例如5-(-8)=13。
* 各种标志的动作、32位运算中软元件的指定方法，连续执行型和脉冲执行型的差异等均与前述加法指令相同。

### 3、乘法指令FNC22（MUL）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109152806228.png" alt="image-20231109152806228" style="zoom:50%;" />

#### （2）指令说明

* 乘法指令是将指定的源操作元件中的二进制数相乘，结果送到指定的目标操作元件中去。乘法指令功能说明如下图所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109152841640.png" alt="image-20231109152841640" style="zoom:50%;" />

注意：乘法和后面要介绍的除法指令，更加要注意数据寄存器的位数问题！

* 它分16位和32位两种运算。

  * 若为16位运算，执行条件X0由OFF→ON时，（D0）×（D2）→（D5，D4）。源操作数是16位，目标操作数是32位。当（D0）=8、（D2）=9时，（D5，D4）=72。最高位为符号位，0为正，1为负。

  * 若为32位运算，执行条件X0由OFF→ON时，（D1,DO）×（D3,D2）→（D7，D6，D5，D4）。源操作数是32位，目标操作数是64位。

    当（D1,D0)=150，（D3,D2)=189时，（D7,D6,D5,D4）=28350。最高位为符号位，0为正，1为负。

### 4、除法指令FNC23（DIV）

#### （2）指令说明

除法指令是将指定的源元件中的二进制数相除，[S1]为被除数，[S2]为除数，商送到指定的目标元件[D]中去，余数送到[D]的下一个目标元件。DIV除法指令功能说明如下图所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109153105515.png" alt="image-20231109153105515" style="zoom:50%;" />

* 除法指令也分16位和32位两种情况进行操作。
  * 若为16位运算。执行条件X0由OFF→ON时，（D0）÷（D2）→（D4）。当（DO）=19，（D2）=3时，(D4)=6，（D5)=1。
  * 若为32位运算，执行条件X1由OFF→ON时，（D1，D0）÷（D3，D2），商在（D5，D4），余数在（D7，D6）中。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109153242631.png" alt="image-20231109153242631" style="zoom:50%;" />

### 5、加1指令FNC24（INC）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109153332383.png" alt="image-20231109153332383" style="zoom:50%;" />

#### （2）指令说明

加1指令功能说明如下图所示。当X0由OFF→ON变化时，由[D]指定的元件D10中的二进制数自动加1。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109153446008.png" alt="image-20231109153446008" style="zoom:50%;" />

【注意】

1. 只有一个操作数；
2. 一般情况下，需要带（P），为什么?
3. 如果没有P，则需在程序中设置比较指令，让其等于某值时，让其启动加一指令的条件触点断开。

* 若用连续指令时，每个扫描周期加1。
* 16位运算时，+32767再加1就变为-32768，**但标志不置位**（即不影响标志位）。
* 32位运算时，+2147483647再加1就变为-2147483648，标志也不置位。

### 举例：四则运算式的实现

（教材P119页）

某控制程序中要进行算式（38X/255）+2的运算。

其中“X”代表输入端口K2X0送入的二进制数，运算结果需送输出口K2Y0；

X20为启停开关。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109160952306.png" alt="image-20231109160952306" style="zoom:50%;" />

# §7-1 概述

作为控制设备，可编程控制器在构成系统时，必须和**电源**、**主令装置**、**传感设备**及**驱动执行机构**相连接，安全可靠的设备配置，正确地接线，充分利用输入/输出口的资源，是输入/输出接口技术的主要内容。

## 一、电源及接线

### 1、输入端口

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109162050183.png" alt="image-20231109162050183" style="zoom:50%;" />

* 输入端口一般包括连接**按钮**、**开关**（含继电器的触点）及各类**传感设备**。这些器件功率消耗都很小，**PLC内部**一般设置**有专用电源**为输入口连接的这些设备**供电**。
* 一只按钮连接于X1及COM端，一只传感器连接于X0及COM端，按钮及COM端间的电源是机内24V电源提供的。
* 当**输入口接入**的器件不是无源触点而是**传感器**时，**要注意传感器的极性**，选择正确的电流方向接入电路。（实际上，此处的传感器还是利用三极管的开关特性！）
* 在PLC中一般COM端为机内电源的负极。
* 输入端口侧设有标记为L及N的端子，这是接入工频电源的，一般为85～260V均可使用，这是PLC的原始工作电源。

### 2、输出端口

输出口在接入电路时，均和执行器件相连接，主要是各种**继电器**、**电磁阀**、**指示灯**等。这类设备本身所需的推动电源功率较大，且电源种类各异。**PLC一般不提供执行器件的工作电源**，需由控制系统另外解决。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109162529912.png" alt="image-20231109162529912" style="zoom:50%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231109163029822.png" alt="image-20231109163029822" style="zoom:50%;" />

* 为适应输出设备需多种电源的情况，PLC的输出端口一般是分组设置的。
* 在可编程序控制器的用户手册上，可查到该机型**输出口和各个COM端的对应情况**。
* 不对应的输出口和COM端是不能构成通路的。
* Y0及Y1口都使用直流电源，可将COM0及COM1连接在一起的。
* COM2及COM3通过外接线连接在一起了，这是因为Y2～Y5口上的设备使用电源的类型及电压等级是一样的。

#### 注意

* 输出口适合连接**哪种电源的驱动**设备，还与**输出**口的类型有关：
  * 如输出口需连接交流接触器的线圈，输出口需配接**交流**电源，这时PLC输出口类型可以是**继电器型**或**晶闸管（可控硅）型**。
  * 输出口需连接**直流**驱动的线圈时，输出口的类型可以是**继电器型**的或**晶体管型**的。采用晶体管型输出口时还需考虑电流的方向。

【问】如果是晶体管输出类型，怎样才能带交流负载？（不可以，如果一定要带，要间接地带交流负载）

* 输入口及输出口的COM端是**相互隔离**的。

## 二、输入输出口的电流定额

### 1、输入端口

* PLC自带的输入口电源一般为**直流24V**。
* 输入口**每一点**的电流定额一般为**7mA**，这个电流是输入口短接时产生的最大电流。
* PLC的输入口信号传递所需的**最小电流一般为2mA**左右。为了保障最小有效电流，输入口所接器件的**总阻抗要小于2kΩ**。
* 输入口**机内电源功率**一般只有**几瓦**，当输入口所接传感器所需要的功耗较大时，需另配专用电源供电。

### 2、输出端口

* PLC**输出接口**所能通过的**最大电流**随机型不同而不同，一般为**1A**或**2A**；
* 当负载电流额定值大于端口电流最大值时，需**增加中间继电器**。下图就是增加中间继电器时的线路连接图。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116141323725.png" alt="image-20231116141323725" style="zoom:50%;" />

## 三、输入输出口及端口设备的安全保护

* PLC输入口**额定电压**一般为直流**24V**；
* 有一些型号的PLC输入口是不接驱动电源的（如三菱FX系列PLC）；
* PLC输出口的额定电压通常为**工频**低压交流电源（220V AC）和直流电源（多数是24V DC）。

#### 注意

当输入、输出端口连接有**电感类设备**时，为了防止**电路关断时刻产生高电压**对输入、输出口造成破坏，应在感性元件两端加接保护元件。

* 对于直流电源，应**并接续流二极管**（续流二极管可以选1A的管子，其额定电压应大于电源电压的3倍）；
* 对于交流电路，应**并接阻容电路**（阻容电路中电阻可取51～120Ω，电容可取0.1～0.47μF。电容的额定电压应大于电源的峰值电压）。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116142111488.png" alt="image-20231116142111488" style="zoom:50%;" />

## 四、输入输出口的利用及扩展

### 1、利用COM端扩展输入口

可编程序控制器的输入口需要和COM端构成回路。如果在COM端上加接分路开关，对输入信号进行分组选择，则可以使输入口得到扩展。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116142707346.png" alt="image-20231116142707346" style="zoom: 33%;" />

* 当开关S处于**自动状态**时，开关SB3、SB4被接入电路；
* 开关S处于**手动位置**时，开关SB1、SB2被接入电路。
* 这种扩展方式可用于工作中两种**不频繁交换的场合**。开关S可以是手动操作的切换开关。

#### 注意

二极管是用来切断**寄生电路**

* 假设图中没有二极管，系统处于自动状态，SB1、SB2、SB3闭合，SB4断开，这时将有电流从X2端子流出，经SB2、SB1、SB3形成的寄生回路流回COM端，**使输入继电器X2错误地变为“1”状态**。各开关串联二极管后，切断了寄生回路，避免了错误输入的产生。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116143032360.png" alt="image-20231116143032360" style="zoom: 50%;" />

### 2、利用输出端扩展输入口

如果每个输入口上都接有多组输入信号，开关S就必须是一个多掷开关。这样的多掷开关如果手动操作是十分不方便的，故采用几个输出口代替这个投掷开关。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116143143079.png" alt="image-20231116143143079" style="zoom:50%;" />

#### 这是一个三组输入的例子

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116143439794.png" alt="image-20231116143439794" style="zoom:50%;" />

* Y0接通时，S1、S2、S3相当于被选中而接入到相应输入口。Y1接通时，读取S4、S5、S6工作状态。Y2接通时，S7、S8、S9工作信号被读取。
* Y0、Y1、Y2的控制则要靠软件实现。需要在程序中安排合适的时机，接通某个输出口使机器输入所需的信号。
* 输入信号的这种读取方式，在使用拨码开关时常见。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116144001177.png" alt="image-20231116144001177" style="zoom:67%;" />

相关输出口通过扫描接通，以扫描读入并刷新输入数据。图中时间继电器T10构成振荡器，用以产生一个定时脉冲。然后用这个脉冲实现移位操作，再使用顺序置“1”的辅助继电器，使输出继电器置“1”，完成输入信号的分时读入工作。

#### 注意

* 上图输入口的接线就像个矩阵，因而这种端口扩展方法被称为“矩阵法”。
* 这类方法处理的输入信号都是相对稳定的，如信号的变化比扫描的时间快，信号就有丢失的危险。

### 3、利用输出端扩展输出口

将以上的思想应用在输出口的扩展上，用几个输出口轮流接通，实现另外一些输出口上连接的多组输出设备分时接通，就可实现利用输出端扩展输出口的目的。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116144226561.png" alt="image-20231116144226561" style="zoom: 33%;" />

* 这是一组输出口上接有多组显示器件作动态分时显示的接线图。
* 4513芯片是译码器
* LE：片选端

### 4、利用机内器件扩展输入输出口

当机器各种口的资源都不多时，可以利用机内的计数器、辅助继电器实现输入输出口的扩展。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116144556591.png" alt="image-20231116144556591" style="zoom: 50%;" />

这是一个只用一只按钮实现启动、停止两个功能的梯形图。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116145404685.png" alt="image-20231116145404685" style="zoom:50%;" />

* 利用限位开关加一个计数器实现多位置限位。
* 两只限位开关的常开触点并联接于PLC的输入口X10上。X10作为计数器C10的计数脉冲工作。装在小车上的撞块每撞击一次限位开关，C10则计一次数。系统工作之初，在小车位于轨道左端时，通过启动配置程序使计数器计数值为1，电动机反转；小车向右运行到达终端时，计数器计2，电动机恢复为正转。
* 应该用32位计数器C200而不是C10

### 5、利用线路连接扩展输出口

* 利用输入输出口的接线也可以达到扩展输入输出口的目的。

#### 例如

可将两个相互作用的信号直接接在一个输入口上串联（？教材P185）连接。可以将两个同步动作的输出信号并联起来，或如左图所示将手动按钮直接并接在输出口上。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116145557510.png" alt="image-20231116145557510" style="zoom:50%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116145950091.png" alt="image-20231116145950091" style="zoom:50%;" />

# §7-2 PLC的输入接口电路

PLC的控制系统中有输入/输出设备，常见的输入电器有按钮、行程开关、转换开关、接近开关、霍尔开关、**拨码开关**、各种传感器等。正确连接输入/输出电路，是保证PLC安全可靠工作的前提。

## 一、PLC与按钮、开关等输入元件的连接

三菱FX系列PLC基本单元的输入与按钮、开关、限位开关等的接口如下图所示。按钮（或开关）的两头，一头接到PLC的输入端（例如X0、X1、….），另一头连在一起接到公共COM端上。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116150455982.png" alt="image-20231116150455982" style="zoom:50%;" />

## 二、PLC与拨码开关的接口电路

拨码开关在 PLC控制系统中常常用到，如下图所示为一位拨码开关的示意图。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116150600973.png" alt="image-20231116150600973" style="zoom:50%;" />

### 拨码开关有两种

* 一种是**BCD码拨码**开关，即从0～9，输出为8421 BCD码。
* 另一种是**十六进制拨码**开关，即从0～F，输出为二进制码。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116150729275.png" alt="image-20231116150729275" style="zoom:50%;" />

* 4位拨码器的COM端连在一起，接到电源的正极或负极，电源的负极（或正极）与PLC的COM端相连。
* **每位拨码开关的4条数据线按一定顺序接到PLC的4个输入点上**。电源的+、-极连接取决于PLC输入的内部电路。
* 三菱PLC不需要外置电源，直接COM相连。

#### 优点

拨码开关可以方便地进行数据变更，直观明了。如**控制系统中需要经常修改数据**，可使用4位拨码开关组成一组拨码器与PLC相连。

#### 缺点

此方法**占用PLC的输入点较多**，因此若不是十分必要的场合，一般不要采用这种方法。

## 三、PLC与传感器元件的接口电路

传感器的种类很多，其输出方式也各不相同。接近开关、光电开关、磁性开关等为两线式传感器（a）。霍尔开关为三线式传感器（b）。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116151501541.png" alt="image-20231116151501541" style="zoom:50%;" />

# §7-3 PLC的输出接口电路

## 一、输出接口电路

PLC的输出方式有三种，一是**继电器**方式（a），二是**晶体管**方式（b），三是**晶闸管**方式（c）。这三种PLC输出模块所接的外部负载也各不相同的。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116151649824.png" alt="image-20231116151649824" style="zoom: 67%;" />

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116152152842.png" alt="image-20231116152152842" style="zoom:67%;" />

## 二、输出负载的抗干扰措施

PLC与外接感性负载连接时，为了防止其误动作或瞬间干扰，对感性负载要加入抗干扰措施。

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116152329291.png" alt="image-20231116152329291" style="zoom: 50%;" />

* **直流接口电路**：要在直流感性负载两端**并联二极管**。并联的二极管可选1A的管子，其耐压值大于负载电源电压的5～10倍。接线时要注意二极管的极性。
* **交流感性负载**：要与负载**并联阻容吸收电路**。阻容吸收电路的电阻可选51～120Ω，功率为2W以上，电容可取0.1～0.47pF，耐压应大于电源的峰值电压。

## 三、PLC电源电路

<img src="%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2.assets/image-20231116153725413.png" alt="image-20231116153725413" style="zoom:50%;" />

* PLC控制系统的电源除交流电源外，还包括PLC的直流电源。
* 一般情况下，交流电源可直接与电网相连，而输入设备（开关等）的直流电源和输出负载的直流电源等，最好分别采用独立的直流供电电源。
* 220V AC交流电必须要经过隔离变压器，才能加到PLC上。
