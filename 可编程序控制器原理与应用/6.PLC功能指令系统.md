* **基本指令**是基于继电器、定时器、计数器类软元件，主要用于**逻辑功能**处理的指令。
* **步控指令**用于顺序逻辑控制系统。
* **功能指令**主要用于**数据的传送**、**运算**、**变换**及**程序控制**等功能。在工业自动化控制领域中，许多场合是需要数据运算和特殊处理。

三菱FX系列PLC的功能指令用功能符号**FNC00～FNC◻◻◻**表示，各条指令有相对应的助记符表示其功能意义。

例如：**FNC12**，表示的助记符号为：**MOV**（其指令含义为数据传送）

功能编号（FNC）与助记符是一一对应的。不同型号的FX系列PLC，其所拥有的功能指令条数不相等。

# §6-1 功能指令的表示形式及含义

## 一、功能指令的表示形式

![image-20231102143457525](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102143457525.png)

* 方框为功能框，分别含有功能指令的名称和参数，参数可以是相关数据、地址或其他数据
* X0是执行该条指令的条件

$$
\rm(D0)+123\to(D2)
$$

当X0合上后（可称：X0为ON或X0=1），数据寄存器DO的内容加上123（十进制），然后送数据寄存器D2中。

## 二、功能指令的含义

![image-20231102143648113](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102143648113.png)

* ①为**功能代号**（FNC）：每条功能指令都有一固定的编号，功能指令代号从FNC00～FNC246。
* ②为**助记符**：是该条指令的英文缩写词。如加法指令用英文缩写为ADD。
* ③为**数据长度**（D）指示：功能指令中大多数涉及到数据运算和操作，而数据的表示以字长表示,有16位和32位之分。因此，<u>有（D）表示的即为32位数据操作指令，无（D）表示的则为16位数据操作指令</u>。
* ④为**脉冲/连续执行指令标志**（P）： 功能指令中若带**有（P）**，则为脉冲执行指令，即**当条件满足时仅执行一个扫描周期**。若指令中没有（P）则为连续执行指令。
* ⑤为某些**特殊指令连续执行的符号**。如果为加1指令，则该指令为连续执行的加1指令，每一扫描周期“源”的内容都发生变化。
* ⑥为**操作数**： 即功能指令所涉及的参数（或称数据）。

#### 「例」

![image-20231102143953790](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102143953790.png)

1. 16位数据操作，即将（D10）的内容传送到（D12）中
2. 32位数据操作，即将（D21，D20）的内容传送到（D23，D22）中

##### 脉冲执行指令在数据处理中是很有用的

* 加法指令在脉冲形式指令执行时，加数和被加数做一次加法运算，而连续形式指令执行时，每一个扫描周期都要相加一次。
* 某些特别指令，如：加1指令FNC24（INC）、减1指令FNC25（DEC）等。在用连续执行指令时应特别注意，它在每个扫描周期，其结果内容均在发生着变化。

#### 注意

操作数分为：源操作数、目标操作数、其他操作数

1. **源操作数**：是指功能指令执行后，不改变其内容的操作数，用**S**表示。
2. **目标操作数**：是指功能指令执行后，将其内容改变的操作数，用**D**表示。
3. **其他操作数**：既不是源操作数，又不是目标操作数，则称为：其它操作数，用m、n表示。 **其它操作数往往是常数**， 或者是对源、目标操作数进行补充说明的有关参数。表示常数时，一般用K表示十进制数，H表示十六进制数。

#### 注意

1. 在一条指令中，源操作数、目标操作数及其他操作数都可能不止一个（也可以一个也没有），此时均可以用序列数字表示，以示区别。例如S1、S2、...；D1、D2、….；m1、m2、…..；n1、n2....
2. 操作数若是间接操作数，即通过变址取得数据，则在功能指令操作数旁加有一点“•”，例如：[S1•]、[S2•]、[D1•]、[D2•]、[m1•]等。
3. **操作数可使用PLC内部的各种位元件**，例如：X、Y、M、S等，也可以用这些位元件的组合，以**KnX**，**KnY**，**KnM**，**KnS**等形式表示。
4. 数据**寄存器D**，或**定时器T**，或**计数器C**的**当前值**寄存器也**可作为操作数**。
5. 一般数据寄存器为16位，在处理32位数据时，将使用一对数据寄存器组合。 例如将数据寄存器D0指定为32位指令的操作数时，则**（D1，D0）中的D1为高16位，D0为低16位**。T、C的当前值寄存器也可作为一般寄存器处理，其方法同数据寄存器。
6. 计数器**C200～C255**为**32位**数据寄存器，使用过程中**不能**当作16位数据进行操作。

### 脉冲型、连续执行型指令图例

![image-20231102150144466](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102150144466.png)

# §6-2 功能指令的分类与操作数说明

## 一、功能指令的分类

共14个分类

#### 程序流程指令

例如CJ（条件跳转）、CALL（子程序调用）等；

#### 传送与比较指令

例如MOV（传送）、CMP（比较）、ZCP（区间比较）等；

#### 四则运算指令

例如ADD（二进制加法）、SUB（二进制减法）、NEG（求补码）等；

#### 循环移位指令

例如ROR（循环右移）、ROL（循环左移）、SFIR（位右移）、SFTL（位左移）等；

#### 数据处理指令

例如ZRST（批次复位）、DECO（译码）、SQR（BIN开方运算）等；

#### 高速处理指令

例如REF（输入/输出刷新）、MTR（矩阵输入）、PLSY（脉冲输出）等；

#### 方便指令

例如IST（初始化）、SER（数据查找）、SORT（数据排序）等；

#### 外围设备（I/O）指令

例如TKY（数字键0～9输入）、HKY（16键输入）、FROM（BFM读出）、TO（BFM写入）；

#### 外围设备（SER）指令

例如RS（串形数据传送）、PRUN（数据传送）、PLID（PLID运算）、CCD（校验码）；

#### 浮点数指令

例如 EADD（二进制浮点加法）、EMUL（二进制浮点乘法）、ECMP（二进制浮点数比较）、INT（浮点取整数）等。

#### 定位指令

例如ABS（ABS值读出）、PLSV（可变速的脉冲输出）、DRVI（相对定位）、DRVA（绝对定位）。

#### 时钟指令

例如：TCMP（时钟数据比较）、TRD（时钟数据读出）、TNR（时钟数据写入）等。

#### 外围设备指令

例如：GRY（格雷码变换）、RD3A（模拟块读出）WR3A（模拟块写入）等。

#### 接点比较指令

例如：LD=（两数相等）、LD<>（两数不等）、LD>（S1大于S2）、LD<（S1小于S2）等。

## 二、功能指令操作数说明

功能指令在数据处理和运算过程中，均要用到有关**数据寄存器**、**变址寄存器**、**中断指针**和**特殊辅助继电器**等，对这些功能指令的操作数，在编程使用过程中，要很好地了解和掌握它，并按有关规则使用。

### 1、数据寄存器与位组合数据

#### （1）数据寄存器（D）

* 数据寄存器是用于存储数值数据的；

* 其值可通过应用指令、数据存取单元及编程装置进行读出或写入。

* 数据寄存器都是16位（最高为符号位），可处理的数值范围为-32768～+32767；

* 两个相邻数据寄存器可组成32位数据存储器（最高位为符号位），可处理的数值范围为-2147483648～+2147483647；

* 在进行32位操作时，只要指定低位编号即可，例如D0。而高位则为继其之后的编号（即为D1），即自动占有。

  低位地址号可以是奇数或偶数，由于考虑到外围设备的监视功能，建议**低位**的编号**采用偶数**编号。

  例如：用DO表示（D1，D0）32位数据寄存器的编号。

* 数据寄存器又分一般型、停电保持型和特殊型。

##### 注意

1. 一般型数据寄存器一旦写入数据，只要不再写入其他数据，其内容就不会变化。但在PLC从运行到停止时或停电时，所有数据将清零。只有一种情况例外，若特殊辅助继电器M8033为ON，则数据可以保持。
2. 利用外围设备的参数设定，可改变 $\rm FX_{2N}$ 、 $\rm FX_{2NC}$ PLC的一般型与停电保持型的分配（除停电保持专用的寄存器以外）。若将停电保持专用数据寄存器作为一般用途时，则需要在程序起始步使用RST或ZRST指令（批次复位，即：区间复位）清除其内容。
3. 在使用PLC与计算机PC间连接通讯的情况下，有一部分的数据寄存器将被链接地址所占用。

#### （2）位组合数据

在FX系列PLC中，均是使用4位BCD码来表示1位十进制数据。这样对于位元件来讲，4位一个组合，表示一个十进制数。所以在功能指令中，常用KnX、KnY、KnM、KnS这种位组合形式表达一个数。

##### 例如

教材P82：如果是K1X10，则是哪几个输入继电器组合？

* K1 X0：由X3～X0，4个输入继电器的组合。
* K2 X0：由X7～X0，8个输入继电器的组合。
* K3 Y0：由Y13～Y10、Y7～Y0，12个输出继电器的组合。
* K4 Y0：由Y17～Y10、Y7～Y0，16个输出继电器的组合。

### 2、变址寄存器（V、Z）

#### （1）变址寄存器的形式

![image-20231102153120091](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102153120091.png)

* 变址寄存器同普通的数据寄存器一样，是进行数据读出、写入的寄存器，字长为16位，共有16个，分别为V0～V7和Z0～Z7。如图（a）。
* 变址寄存器在功能指令操作中，可以与其他的软元件编号或数值组合使用。V、Z自身也可以组合成32位数据寄存器。如图（b）
* 变址寄存器的内容，与软元件组合，可以改变软元件的地址。可以利用变址寄存器变址的软元件是X、Y、M、S、K、KnX、KnY、KnM、KnS 等。例如：V＝6，K20V则为K26（K20+6）；若V=7，K20V变为K27（K20+7）。

##### 举例

![image-20231102153252274](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102153252274.png)

* 当V=9、Z=12时：D5V=D5+9=D14；D10Z=D10+12=D22。所以，
* 当X0=1时，则（D14）→（D22）。
* 当V=8时，则D5+8=D13，（D13）→（D22）

#### （2）变址寄存器有关参数的修改

![image-20231102153715580](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102153715580.png)

### 3、标志位

（教材P85）

功能指令在操作过程中，其运算结果要影响某些特殊继电器或寄存器，通常称其为标志（位）。标志（位）又分一般标志（位）、运算出错标志（位）和功能扩展用标志（位）。

#### （1）一般标志（位）

在功能指令操作中，其结果将影响下列标志位：

* M8020：零标志，如运算结果为0时动作；
* M8021：借位标志，减法时被减数不够减时动作；
* M8022：进位标志，如运算结果发生进位时动作；
* M8029：指令执行结束标志。

这些标志在各种指令每次执行完毕后，将根据结果使它们接通或断开。

#### （2）运算出错标志（位）

如果在功能指令的结构、可用软元件及其编号范围等方面有错误时，或在运算过程中出现错误，下列标志位会动作，同时记录出错信息。

* M8067：运算出错标志；
* D8068：运算错误代码编号存储（应该是：D8067，**无锁存**）；
* D8069：错误发生的步序号记录存储。

在PLC由STOP→RUN时都是瞬间清除，若出现运算错误，则M8068（运算出错**锁存**）保持动作，而D8068（存储步序号**锁存**）中存储发生错误的步序号。

### 4、分支指针P

指针是用作跳转、中断等程序的入口地址，与跳转、子程序、中断程序等指令一起应用。地址号采用十进制分配。

按其用途来分，可分为分支用指针（P）和中断用指针（I）两类。

分支用指针P是用于条件跳转指令、子程序调用指令的入口地址。其地址号分别为P0～P62（63点）和P0～P127（127点）。而其中的P63为跳转结束指针，相当于END指令。

#### 注意

* 在编程时，指针号不能重复使用；
* P63是跳转结束指针，在程序中不编程，如图所示；

![image-20231102161324005](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102161324005.png)

* P63是使用FNC00（CJ）指令时，意味着向END跳转的特殊指针。因此，在一般情况下，若用P63作为编程的地址时，程序会发生错误。

# §6-3 功能指令说明

## 一、跳转指令说明

### 1、条件跳转指令FNC00（CJ）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

![image-20231102161506477](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102161506477.png)

#### （2）指令说明

下图为条件跳转指令在梯形图中的具体应用格式。

![image-20231102161626963](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102161626963.png)

* 若X0为ON，程序跳转到标号P8处，X0为OFF，则顺序执行程序，这称为有条件转移。如果执行条件使用M8000，那么称之为无条件跳转，因为M8000为常闭触点（即PLC一旦启动就闭合）。
* 一个标号只能出现一次，多于一次则会出错。两条跳转指令可以使用同一标号。使用CJ（P）跳转指令时,跳转只执行一个扫描周期。
* 编程时，标号占一行，对有意向END步跳转的指针P63编程时，程序中不要对标号P63编程。所以，左边的指令编程是错误的。

![image-20231102161803568](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102161803568.png)

* 在程序运行时，当X0为OFF时，程序正常运行。X1=0，Y0=1；X2=1，当T0定时2.5s后，Y1=1；X3=0时开始计数器清零，C0计5次，Y2=1。

* 若X0为ON时，则跳转到P63（END）处，使继电器输出，而定时器、计数器值均保持不变。

  此时，若X0为OFF时（P89页为“ON”错误），又继续执行程序，继电器输出根据输入条件动作，而定时器和计数器则继续往下定时或计数。

![image-20231102162045107](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102162045107.png)

#### 举例：自动/手动方式切换编程

![image-20231102162358001](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102162358001.png)

### 2、子程序调用指令

#### FNCO1 （CALL）-FNCO2 （SRET）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

![image-20231102162929861](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102162929861.png)

#### （2）指令说明

* FNCO1（CALL）为子程序调用指令，其操作数对 $\rm FX_{05}$ 、 $\rm FX_{0N}$ 、 $\rm FX_{1s}$ 、  $\rm FX_2$ PLC来说，其指针为P0～P62。 $\rm FX_{1N}$ 、 $\rm FX_{2N}$ 、 $\rm FX_{2NC}$ PLC的指针从P0～P127，P63为END标号，不作指针，标号在程序中仅能使用一次。

* CALL指令在程序中的基本使用格式如下图所示。

  子程序调用CALL指令一般安排在主程序中，主程序的结束有FEND（主程序结束）指令。在子程序的开始端有P××指针，最后由SRET返回指令返回主程序。

![image-20231102163210757](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102163210757.png)

* X0为调用子程序的条件。当X0为ON时，则调用P10～SRET段子程序，并执行。

  当X0为OFF时，程序顺序执行，子程序不执行。

* 子程序调用最多可嵌套5级。

* 子程序P11的调用因采用CALL（P）指令，是脉冲执行方式，所以在X0由OFF→ON时，仅调用P11子程序执行一次。P11子程序执行时，当若X11=1时，又要调用 P12子程序并执行，当P12 子程序执行完毕后，又返回到P11原断点处执行P11子程序，当执行到SRET①处，又返回到主程序。

![image-20231102163400029](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102163400029.png)

#### 举例：子程序调用编程

* 应用子程序调用指令，可以优化程序结构，提高编程效果。
* 当X1为OFF时，若X0为ON时，调用PO（1s）子程序执行； 若 X0 为OFF时，调用 P1（2s）子程序执行；
* 当X1为ON时，不调用P0、P1子程序，而调用P2（4s）子程序执行。

![image-20231102163529784](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102163529784.png)

### 3、主程序结束指令FNC06 （FEND）

#### （1）指令格式

该指令的指令名称、助记符、功能号、操作数及程序步长如下表所示。

![image-20231102163658458](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102163658458.png)

#### （2）指令说明

FEND作为主程序的结束指令。执行此命令，功能同END。

![image-20231102163845431](6.PLC%E5%8A%9F%E8%83%BD%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F.assets/image-20231102163845431.png)